{% extends "dashboard/roles/vendeur/base_vendeur.html" %}
{% load static %}

{% block title %}Interface Vendeur - Walee{% endblock %}

{% block dashboard_content %}
<div x-data="vendeurData()">
    
    <!-- Header -->
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold font-poppins text-walee-dark dark:text-white mb-2">
                    üõçÔ∏è Interface Vendeur
                </h1>
                <p class="text-gray-600 dark:text-gray-400">Cr√©ez des ventes rapidement et suivez vos performances</p>
            </div>
            <div class="flex items-center space-x-3">
                <div class="px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-lg">
                    <p class="text-xs font-medium">Objectif du jour</p>
                    <p class="text-lg font-bold" x-text="stats.objectifProgress + '%'"></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Stats personnelles -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-2">
                <i data-lucide="dollar-sign" class="w-8 h-8"></i>
                <span class="text-sm font-medium" x-text="stats.caEvolution"></span>
            </div>
            <p class="text-sm opacity-90">Mon CA aujourd'hui</p>
            <p class="text-3xl font-bold" x-text="formatMoney(stats.caJour)"></p>
        </div>
        
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-2">
                <i data-lucide="shopping-cart" class="w-8 h-8"></i>
                <span class="text-sm font-medium" x-text="'+' + stats.ventesEvolution"></span>
            </div>
            <p class="text-sm opacity-90">Mes ventes</p>
            <p class="text-3xl font-bold" x-text="stats.ventesJour"></p>
        </div>
        
        <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-2">
                <i data-lucide="users" class="w-8 h-8"></i>
                <span class="text-sm font-medium">+<span x-text="stats.nouveauxClients"></span></span>
            </div>
            <p class="text-sm opacity-90">Mes clients</p>
            <p class="text-3xl font-bold" x-text="stats.clientsTotal"></p>
        </div>
        
        <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-2">
                <i data-lucide="trending-up" class="w-8 h-8"></i>
                <span class="text-sm font-medium">Panier</span>
            </div>
            <p class="text-sm opacity-90">Panier moyen</p>
            <p class="text-3xl font-bold" x-text="formatMoney(stats.panierMoyen)"></p>
        </div>
    </div>
    
    <!-- Actions rapides -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <button @click="nouvelleVente()" 
                class="flex items-center space-x-4 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition border-2 border-walee-blue">
            <div class="w-16 h-16 bg-gradient-to-br from-walee-blue to-walee-indigo rounded-xl flex items-center justify-center">
                <i data-lucide="plus-circle" class="w-8 h-8 text-white"></i>
            </div>
            <div class="text-left">
                <p class="text-lg font-bold text-walee-dark dark:text-white">Nouvelle vente</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Cr√©er une vente rapide</p>
            </div>
        </button>
        
        <button @click="mesClients()" 
                class="flex items-center space-x-4 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition">
            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
                <i data-lucide="users" class="w-8 h-8 text-white"></i>
            </div>
            <div class="text-left">
                <p class="text-lg font-bold text-walee-dark dark:text-white">Mes clients</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">G√©rer mes clients</p>
            </div>
        </button>
        
        <button @click="catalogue()" 
                class="flex items-center space-x-4 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-lg transition">
            <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center">
                <i data-lucide="package" class="w-8 h-8 text-white"></i>
            </div>
            <div class="text-left">
                <p class="text-lg font-bold text-walee-dark dark:text-white">Catalogue</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Voir les produits</p>
            </div>
        </button>
    </div>
    
    <!-- Contenu principal -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Colonne gauche (2/3) -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- Produits populaires -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold text-walee-dark dark:text-white">Produits populaires</h3>
                    <div class="flex items-center space-x-2">
                        <input type="text" 
                               x-model="searchProduit"
                               placeholder="Rechercher..."
                               class="px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg text-sm">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <template x-for="produit in filteredProduits" :key="produit.id">
                        <div class="border-2 border-gray-200 dark:border-gray-700 rounded-xl p-4 hover:border-walee-blue hover:shadow-md transition cursor-pointer"
                             @click="ajouterAuPanier(produit)">
                            <div class="flex items-start justify-between mb-3">
                                <div class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                                    <i data-lucide="package" class="w-6 h-6 text-gray-600 dark:text-gray-400"></i>
                                </div>
                                <span class="px-2 py-1 rounded-full text-xs font-medium"
                                      :class="produit.stock > 10 ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : produit.stock > 0 ? 'bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300' : 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300'">
                                    <span x-text="produit.stock > 0 ? 'Stock: ' + produit.stock : 'Rupture'"></span>
                                </span>
                            </div>
                            <h4 class="font-bold text-gray-900 dark:text-white mb-1" x-text="produit.nom"></h4>
                            <p class="text-xs text-gray-500 dark:text-gray-400" x-text="produit.reference"></p>
                            <p class="text-xs text-gray-500 dark:text-gray-400 font-mono mb-3" x-text="produit.codeBarre"></p>
                            <div class="flex items-center justify-between">
                                <span class="text-xl font-bold text-walee-blue" x-text="formatMoney(produit.prix)"></span>
                                <button class="px-3 py-1 bg-walee-blue text-white text-sm rounded-lg hover:bg-blue-700 transition"
                                        :disabled="produit.stock === 0">
                                    <i data-lucide="plus" class="w-4 h-4 inline"></i>
                                    Ajouter
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Mes ventes du jour -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold text-walee-dark dark:text-white">Mes ventes du jour</h3>
                    <span class="text-sm text-gray-500 dark:text-gray-400" x-text="mesVentes.length + ' ventes'"></span>
                </div>
                
                <div class="space-y-3">
                    <template x-for="vente in mesVentes" :key="vente.id">
                        <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition cursor-pointer"
                             @click="viewVente(vente)">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-100 to-blue-200 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                                    <i data-lucide="shopping-bag" class="w-5 h-5 text-blue-600 dark:text-blue-400"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-900 dark:text-white" x-text="vente.numero"></p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        <span x-text="vente.client"></span> ‚Ä¢ <span x-text="vente.heure"></span>
                                    </p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-walee-blue" x-text="formatMoney(vente.montant)"></p>
                                <span class="inline-flex px-2 py-1 rounded-full text-xs font-medium"
                                      :class="vente.statut === 'Pay√©e' ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 'bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300'">
                                    <span x-text="vente.statut"></span>
                                </span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
        </div>
        
        <!-- Colonne droite (1/3) -->
        <div class="space-y-6">
            
            <!-- Panier en cours -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm sticky top-6">
                <h3 class="text-lg font-bold text-walee-dark dark:text-white mb-4 flex items-center">
                    <i data-lucide="shopping-cart" class="w-5 h-5 mr-2 text-blue-600"></i>
                    Panier en cours
                </h3>
                
                <div x-show="panier.length === 0" class="text-center py-8">
                    <i data-lucide="shopping-cart" class="w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-3"></i>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Panier vide</p>
                </div>
                
                <div x-show="panier.length > 0" class="space-y-3 mb-4">
                    <template x-for="item in panier" :key="item.id">
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900 dark:text-white" x-text="item.nom"></p>
                                <p class="text-xs text-gray-500 dark:text-gray-400" x-text="formatMoney(item.prix)"></p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button @click="diminuerQuantite(item)" 
                                        class="w-6 h-6 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">
                                    <i data-lucide="minus" class="w-3 h-3 mx-auto text-gray-700 dark:text-gray-300"></i>
                                </button>
                                <span class="w-8 text-center font-semibold text-gray-900 dark:text-white" x-text="item.quantite"></span>
                                <button @click="augmenterQuantite(item)" 
                                        class="w-6 h-6 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">
                                    <i data-lucide="plus" class="w-3 h-3 mx-auto text-gray-700 dark:text-gray-300"></i>
                                </button>
                                <button @click="retirerDuPanier(item)" 
                                        class="w-6 h-6 bg-red-100 dark:bg-red-900 rounded hover:bg-red-200 dark:hover:bg-red-800">
                                    <i data-lucide="x" class="w-3 h-3 mx-auto text-red-600 dark:text-red-400"></i>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
                
                <div x-show="panier.length > 0" class="border-t border-gray-200 dark:border-gray-700 pt-4 space-y-3">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-600 dark:text-gray-400">Sous-total</span>
                        <span class="font-semibold text-gray-900 dark:text-white" x-text="formatMoney(sousTotal)"></span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-600 dark:text-gray-400">TVA (18%)</span>
                        <span class="font-semibold text-gray-900 dark:text-white" x-text="formatMoney(tva)"></span>
                    </div>
                    <div class="flex items-center justify-between text-lg font-bold border-t border-gray-200 dark:border-gray-700 pt-3">
                        <span class="text-gray-900 dark:text-white">Total</span>
                        <span class="text-walee-blue" x-text="formatMoney(total)"></span>
                    </div>
                    
                    <button @click="validerVente()" 
                            class="w-full py-3 bg-gradient-to-r from-walee-blue to-walee-indigo text-white font-semibold rounded-xl hover:shadow-lg transition">
                        <i data-lucide="check" class="w-5 h-5 inline mr-2"></i>
                        Valider la vente
                    </button>
                    <button @click="viderPanier()" 
                            class="w-full py-2 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                        Vider le panier
                    </button>
                </div>
            </div>
            
            <!-- Classement vendeurs -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm">
                <h3 class="text-lg font-bold text-walee-dark dark:text-white mb-4 flex items-center">
                    <i data-lucide="trophy" class="w-5 h-5 mr-2 text-yellow-600"></i>
                    Top vendeurs
                </h3>
                
                <div class="space-y-3">
                    <template x-for="(vendeur, index) in topVendeurs" :key="vendeur.id">
                        <div class="flex items-center space-x-3 p-3 rounded-lg"
                             :class="vendeur.moi ? 'bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-500' : 'bg-gray-50 dark:bg-gray-700'">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-white"
                                 :class="index === 0 ? 'bg-yellow-500' : index === 1 ? 'bg-gray-400' : index === 2 ? 'bg-orange-600' : 'bg-gray-500'">
                                <span x-text="index + 1"></span>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-semibold text-gray-900 dark:text-white">
                                    <span x-text="vendeur.nom"></span>
                                    <span x-show="vendeur.moi" class="text-blue-600 dark:text-blue-400"> (Vous)</span>
                                </p>
                                <p class="text-xs text-gray-500 dark:text-gray-400" x-text="formatMoney(vendeur.ca)"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
        </div>
        
    </div>
    
</div>
{% endblock %}

{% block extra_js %}
<script>
function vendeurData() {
    return {
        searchProduit: '',
        panier: [],
        
        stats: {
            caJour: 720000,
            caEvolution: '+15%',
            ventesJour: 15,
            ventesEvolution: 3,
            clientsTotal: 28,
            nouveauxClients: 2,
            panierMoyen: 48000,
            objectifProgress: 72
        },
        
        produits: [
            { id: 1, nom: 'Laptop HP Pavilion', reference: 'PRD-001', codeBarre: '5901234123457', prix: 450000, stock: 15 },
            { id: 2, nom: 'iPhone 13 Pro', reference: 'PRD-002', codeBarre: '0190199218792', prix: 650000, stock: 8 },
            { id: 3, nom: 'Samsung Galaxy S23', reference: 'PRD-003', codeBarre: '8806094667523', prix: 550000, stock: 5 },
            { id: 4, nom: 'MacBook Air M2', reference: 'PRD-004', codeBarre: '0194252707104', prix: 850000, stock: 12 },
            { id: 5, nom: 'iPad Pro 11"', reference: 'PRD-005', codeBarre: '0194252707203', prix: 520000, stock: 0 },
            { id: 6, nom: 'AirPods Pro', reference: 'PRD-006', codeBarre: '0194252721083', prix: 180000, stock: 25 }
        ],
        
        mesVentes: [
            { id: 1, numero: 'VNT-045', client: 'Jean Kouassi', montant: 125000, statut: 'Pay√©e', heure: '14:30' },
            { id: 2, numero: 'VNT-044', client: 'Fatou Diallo', montant: 89500, statut: 'Pay√©e', heure: '14:15' },
            { id: 3, numero: 'VNT-043', client: 'Yao Brou', montant: 245000, statut: 'Pay√©e', heure: '13:50' }
        ],
        
        topVendeurs: [
            { id: 1, nom: 'Marie Martin', ca: 850000, moi: false },
            { id: 2, nom: 'Vous', ca: 720000, moi: true },
            { id: 3, nom: 'Sophie Laurent', ca: 650000, moi: false },
            { id: 4, nom: 'Pierre Dubois', ca: 230000, moi: false }
        ],
        
        get filteredProduits() {
            if (!this.searchProduit) return this.produits;
            return this.produits.filter(p => 
                p.nom.toLowerCase().includes(this.searchProduit.toLowerCase()) ||
                p.reference.toLowerCase().includes(this.searchProduit.toLowerCase())
            );
        },
        
        get sousTotal() {
            return this.panier.reduce((sum, item) => sum + (item.prix * item.quantite), 0);
        },
        
        get tva() {
            return this.sousTotal * 0.18;
        },
        
        get total() {
            return this.sousTotal + this.tva;
        },
        
        ajouterAuPanier(produit) {
            if (produit.stock === 0) {
                alert('‚ùå Produit en rupture de stock');
                return;
            }
            
            const existant = this.panier.find(item => item.id === produit.id);
            if (existant) {
                if (existant.quantite < produit.stock) {
                    existant.quantite++;
                } else {
                    alert('‚ùå Stock insuffisant');
                }
            } else {
                this.panier.push({
                    ...produit,
                    quantite: 1
                });
            }
        },
        
        augmenterQuantite(item) {
            const produit = this.produits.find(p => p.id === item.id);
            if (item.quantite < produit.stock) {
                item.quantite++;
            } else {
                alert('‚ùå Stock insuffisant');
            }
        },
        
        diminuerQuantite(item) {
            if (item.quantite > 1) {
                item.quantite--;
            } else {
                this.retirerDuPanier(item);
            }
        },
        
        retirerDuPanier(item) {
            this.panier = this.panier.filter(i => i.id !== item.id);
        },
        
        viderPanier() {
            if (confirm('Vider le panier ?')) {
                this.panier = [];
            }
        },
        
        validerVente() {
            if (this.panier.length === 0) {
                alert('‚ùå Le panier est vide');
                return;
            }
            
            alert(`‚úÖ Vente valid√©e !\n\nMontant: ${this.formatMoney(this.total)}\nArticles: ${this.panier.length}\n\nFonctionnalit√© compl√®te √† venir`);
            this.panier = [];
        },
        
        nouvelleVente() {
            alert('üõçÔ∏è Nouvelle vente\n\nAjoutez des produits au panier pour commencer');
        },
        
        mesClients() {
            alert('üë• Mes clients\n\nFonctionnalit√© √† venir');
        },
        
        catalogue() {
            alert('üì¶ Catalogue complet\n\nFonctionnalit√© √† venir');
        },
        
        viewVente(vente) {
            alert(`üìã D√©tails de la vente ${vente.numero}\n\nClient: ${vente.client}\nMontant: ${this.formatMoney(vente.montant)}\nStatut: ${vente.statut}`);
        },
        
        formatMoney(amount) {
            if (amount >= 1000000) {
                return (amount / 1000000).toFixed(1) + 'M FCFA';
            }
            return new Intl.NumberFormat('fr-FR').format(amount) + ' FCFA';
        }
    }
}
</script>
{% endblock %}
