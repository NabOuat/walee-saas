{% extends "dashboard/roles/rh/base_rh.html" %}
{% load static %}
{% block title %}Recrutement - RH - Walee{% endblock %}
{% block dashboard_content %}
<div x-data="recrutementData()" x-init="init()">
<div class="flex items-center justify-between mb-6">
<div><h1 class="text-2xl font-bold text-gray-900 dark:text-white">Recrutement</h1><p class="text-sm text-gray-600 dark:text-gray-400 mt-1"><span x-text="offres.length"></span> offre(s) active(s)</p></div>
<button @click="openModal('nouvelle')" class="px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i><span>Nouvelle Offre</span></button>
</div>
<div class="grid grid-cols-4 gap-4 mb-6">
<div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 border border-blue-200"><div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mb-2"><i data-lucide="briefcase" class="w-5 h-5 text-white"></i></div><p class="text-2xl font-bold text-blue-900 dark:text-blue-100" x-text="offres.length"></p><p class="text-xs text-blue-600 font-medium">Offres Actives</p></div>
<div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200"><div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mb-2"><i data-lucide="users" class="w-5 h-5 text-white"></i></div><p class="text-2xl font-bold text-green-900 dark:text-green-100">47</p><p class="text-xs text-green-600 font-medium">Candidatures</p></div>
<div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 border border-orange-200"><div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center mb-2"><i data-lucide="user-check" class="w-5 h-5 text-white"></i></div><p class="text-2xl font-bold text-orange-900 dark:text-orange-100">12</p><p class="text-xs text-orange-600 font-medium">En Entretien</p></div>
<div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 border border-purple-200"><div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center mb-2"><i data-lucide="check-circle" class="w-5 h-5 text-white"></i></div><p class="text-2xl font-bold text-purple-900 dark:text-purple-100">3</p><p class="text-xs text-purple-600 font-medium">Recrutés</p></div>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
<template x-for="offre in offres" :key="offre.id">
<div class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-lg hover:border-indigo-300 dark:hover:border-indigo-700 transition">
<div class="flex items-start justify-between mb-4"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-gradient-to-br from-indigo-100 to-purple-100 dark:from-indigo-900 dark:to-purple-900 rounded-xl flex items-center justify-center"><i data-lucide="briefcase" class="w-6 h-6 text-indigo-600"></i></div><div><h3 class="font-bold text-gray-900 dark:text-white" x-text="offre.titre"></h3><p class="text-xs text-gray-500" x-text="offre.departement"></p></div></div><span class="px-2.5 py-1 rounded-full text-xs font-semibold" :class="offre.type==='CDI'?'bg-green-100 text-green-700':'bg-blue-100 text-blue-700'" x-text="offre.type"></span></div>
<div class="space-y-2 mb-4"><div class="flex items-center gap-2 text-sm"><i data-lucide="map-pin" class="w-4 h-4 text-gray-400"></i><span class="text-gray-700 dark:text-gray-300" x-text="offre.localisation"></span></div><div class="flex items-center gap-2 text-sm"><i data-lucide="users" class="w-4 h-4 text-gray-400"></i><span class="text-gray-700 dark:text-gray-300"><span x-text="offre.candidatures"></span> candidature(s)</span></div><div class="flex items-center gap-2 text-sm"><i data-lucide="calendar" class="w-4 h-4 text-gray-400"></i><span class="text-gray-700 dark:text-gray-300">Publié le <span x-text="offre.datePublication"></span></span></div></div>
<div class="flex gap-2 pt-3 border-t border-gray-100 dark:border-gray-700"><button @click.prevent="viewOffre(offre)" class="flex-1 px-3 py-2 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 rounded-lg hover:bg-indigo-100 transition text-sm font-medium">Voir</button><button @click.prevent="viewCandidatures(offre)" class="flex-1 px-3 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 rounded-lg hover:bg-blue-100 transition text-sm font-medium">Candidatures</button></div>
</div>
</template>
</div>
<!-- Toast Notification -->
<div x-show="toast.show" 
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 translate-y-2"
     x-transition:enter-end="opacity-100 translate-y-0"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100 translate-y-0"
     x-transition:leave-end="opacity-0 translate-y-2"
     class="fixed top-4 right-4 z-50 max-w-md" style="display:none;">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 flex items-center gap-3">
        <div class="flex-shrink-0">
            <div :class="toast.type==='success'?'bg-green-100 dark:bg-green-900/30 text-green-600':toast.type==='error'?'bg-red-100 dark:bg-red-900/30 text-red-600':'bg-blue-100 dark:bg-blue-900/30 text-blue-600'" 
                 class="w-10 h-10 rounded-full flex items-center justify-center">
                <i :data-lucide="toast.type==='success'?'check-circle':toast.type==='error'?'x-circle':'info'" class="w-5 h-5"></i>
            </div>
        </div>
        <p class="flex-1 text-sm font-medium text-gray-900 dark:text-white" x-text="toast.message"></p>
        <button @click="toast.show=false" class="flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    </div>
</div>

<!-- Modal Détails Offre -->
<div x-show="modalOpen==='details'" x-transition class="fixed inset-0 z-50 overflow-y-auto" style="display:none;">
    <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" @click="closeModal()"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-3xl w-full p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Détails de l'Offre</h3>
                <button @click="closeModal()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <template x-if="selectedOffre">
                <div class="space-y-6">
                    <div class="flex items-start gap-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-xl">
                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-xl flex items-center justify-center"><i data-lucide="briefcase" class="w-8 h-8 text-white"></i></div>
                        <div class="flex-1">
                            <h4 class="text-xl font-bold text-gray-900 dark:text-white mb-1" x-text="selectedOffre.titre"></h4>
                            <div class="flex items-center gap-3 text-sm text-gray-600 dark:text-gray-400">
                                <span x-text="selectedOffre.departement"></span>
                                <span>•</span>
                                <span class="px-2 py-0.5 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded-full font-semibold" x-text="selectedOffre.type"></span>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"><i data-lucide="map-pin" class="w-4 h-4"></i><span class="text-sm font-medium">Localisation</span></div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="selectedOffre.localisation"></p>
                        </div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"><i data-lucide="users" class="w-4 h-4"></i><span class="text-sm font-medium">Candidatures</span></div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white"><span x-text="selectedOffre.candidatures"></span> reçue(s)</p>
                        </div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"><i data-lucide="calendar" class="w-4 h-4"></i><span class="text-sm font-medium">Date de publication</span></div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="selectedOffre.datePublication"></p>
                        </div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"><i data-lucide="clock" class="w-4 h-4"></i><span class="text-sm font-medium">Statut</span></div>
                            <p class="text-lg font-bold text-green-600">Active</p>
                        </div>
                    </div>
                    <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                        <h5 class="font-bold text-gray-900 dark:text-white mb-2">Description du poste</h5>
                        <p class="text-gray-600 dark:text-gray-400">Nous recherchons un professionnel qualifié pour rejoindre notre équipe. Le candidat idéal possède une expérience significative dans le domaine et démontre d'excellentes compétences techniques et relationnelles.</p>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button @click="openModal('candidatures')" class="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium">Voir les candidatures</button>
                        <button @click="closeModal()" class="px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition font-medium">Fermer</button>
                    </div>
                </div>
            </template>
        </div>
    </div>
</div>

<!-- Modal Candidatures -->
<div x-show="modalOpen==='candidatures'" x-transition class="fixed inset-0 z-50 overflow-y-auto" style="display:none;">
    <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" @click="closeModal()"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Candidatures</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1" x-text="selectedOffre ? selectedOffre.titre : ''"></p>
                </div>
                <button @click="closeModal()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="space-y-3">
                <template x-for="i in (selectedOffre ? selectedOffre.candidatures : 0)" :key="i">
                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-900 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-400 to-purple-400 flex items-center justify-center text-white font-bold text-lg">
                                <span x-text="String.fromCharCode(64 + i)"></span>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-900 dark:text-white" x-text="'Candidat ' + i"></h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">candidat<span x-text="i"></span>@email.com</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs rounded-full font-semibold">Nouveau</span>
                                    <span class="text-xs text-gray-500">Il y a <span x-text="i"></span> jour(s)</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button @click.prevent="accepterCandidat(i)" class="px-4 py-2 bg-green-50 dark:bg-green-900/20 text-green-600 rounded-lg hover:bg-green-100 transition text-sm font-medium">Accepter</button>
                            <button @click.prevent="refuserCandidat(i)" class="px-4 py-2 bg-red-50 dark:bg-red-900/20 text-red-600 rounded-lg hover:bg-red-100 transition text-sm font-medium">Refuser</button>
                            <button @click.prevent="voirCVCandidat(i)" class="p-2 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 rounded-lg hover:bg-indigo-100 transition"><i data-lucide="eye" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>

<!-- Modal Nouvelle Offre -->
<div x-show="modalOpen==='nouvelle'" x-transition class="fixed inset-0 z-50 overflow-y-auto" style="display:none;"><div class="flex items-center justify-center min-h-screen px-4"><div class="fixed inset-0 bg-black/50 backdrop-blur-sm" @click="closeModal()"></div><div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full p-6"><div class="flex items-center justify-between mb-6"><h3 class="text-2xl font-bold text-gray-900 dark:text-white">Nouvelle Offre d'Emploi</h3><button @click="closeModal()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"><i data-lucide="x" class="w-5 h-5"></i></button></div><form @submit.prevent="saveOffre()" class="space-y-4"><input type="text" placeholder="Titre du poste" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"><div class="grid grid-cols-2 gap-4"><select required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"><option value="">Type de contrat...</option><option>CDI</option><option>CDD</option><option>Stage</option></select><input type="text" placeholder="Département" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"></div><input type="text" placeholder="Localisation" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"><textarea placeholder="Description du poste..." rows="4" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"></textarea><div class="flex justify-end gap-3 pt-4"><button type="button" @click="closeModal()" class="px-6 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 transition">Annuler</button><button type="submit" class="px-6 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">Publier</button></div></form></div></div></div>
</div>
{% endblock %}
{% block extra_js %}
<script>
function recrutementData(){
    return{
        modalOpen:null,
        toast:{show:false,message:'',type:'success'},
        offres:[
            {id:1,titre:'Développeur Full Stack',departement:'IT',type:'CDI',localisation:'Abidjan',candidatures:15,datePublication:'15/10/2025'},
            {id:2,titre:'Comptable Senior',departement:'Finance',type:'CDI',localisation:'Abidjan',candidatures:22,datePublication:'10/10/2025'},
            {id:3,titre:'Commercial',departement:'Ventes',type:'CDD',localisation:'Bouaké',candidatures:10,datePublication:'05/10/2025'}
        ],
        init(){
            lucide.createIcons();
        },
        openModal(type){
            this.modalOpen=type;
            this.$nextTick(()=>lucide.createIcons());
        },
        closeModal(){
            this.modalOpen=null;
        },
        showToast(message,type='success'){
            this.toast={show:true,message,type};
            setTimeout(()=>{this.toast.show=false},3000);
        },
        selectedOffre:null,
        viewOffre(offre){
            this.selectedOffre=offre;
            this.openModal('details');
        },
        viewCandidatures(offre){
            this.selectedOffre=offre;
            this.openModal('candidatures');
        },
        saveOffre(){
            this.showToast('✅ Offre publiée avec succès !','success');
            this.closeModal();
            this.$nextTick(()=>lucide.createIcons());
        },
        deleteOffre(offre){
            if(confirm(`Êtes-vous sûr de vouloir supprimer l'offre "${offre.titre}" ?`)){
                const index=this.offres.findIndex(o=>o.id===offre.id);
                if(index>-1){
                    this.offres.splice(index,1);
                    this.showToast('🗑️ Offre supprimée avec succès','success');
                }
            }
        },
        accepterCandidat(id){
            this.showToast(`✅ Candidat ${id} accepté ! Invitation à l'entretien envoyée.`,'success');
            this.$nextTick(()=>lucide.createIcons());
        },
        refuserCandidat(id){
            if(confirm(`Refuser le Candidat ${id} ?`)){
                this.showToast(`❌ Candidat ${id} refusé. Email de notification envoyé.`,'error');
                this.$nextTick(()=>lucide.createIcons());
            }
        },
        voirCVCandidat(id){
            this.showToast(`📄 Ouverture du CV du Candidat ${id}...`,'info');
            setTimeout(()=>{
                window.open('#cv-candidat-'+id, '_blank');
            },500);
        }
    }
}
</script>
{% endblock %}
