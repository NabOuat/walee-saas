{% extends "dashboard/roles/rh/base_rh.html" %}
{% load static %}
{% block title %}Gestion des Congés - RH - Walee{% endblock %}
{% block dashboard_content %}
<div x-data="congesData()" x-init="init()">
<div class="flex items-center justify-between mb-6">
<div><h1 class="text-2xl font-bold text-gray-900 dark:text-white">Gestion des Congés</h1><p class="text-sm text-gray-600 dark:text-gray-400 mt-1"><span x-text="demandes.filter(d=>d.statut==='En attente').length"></span> demande(s) en attente</p></div>
<button @click="openModal('nouvelle')" class="px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:from-indigo-700 hover:to-purple-700 transition flex items-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i><span>Nouvelle Demande</span></button>
</div>
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
<div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 border border-blue-200"><div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mb-2"><i data-lucide="calendar" class="w-5 h-5 text-white"></i></div><p class="text-2xl font-bold text-blue-900 dark:text-blue-100" x-text="demandes.length"></p><p class="text-xs text-blue-600 font-medium">Total Demandes</p></div>
<div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 border border-orange-200"><div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center mb-2"><i data-lucide="clock" class="w-5 h-5 text-white"></i></div><p class="text-2xl font-bold text-orange-900 dark:text-orange-100" x-text="demandes.filter(d=>d.statut==='En attente').length"></p><p class="text-xs text-orange-600 font-medium">En Attente</p></div>
<div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 border border-green-200"><div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mb-2"><i data-lucide="check-circle" class="w-5 h-5 text-white"></i></div><p class="text-2xl font-bold text-green-900 dark:text-green-100" x-text="demandes.filter(d=>d.statut==='Approuvé').length"></p><p class="text-xs text-green-600 font-medium">Approuvés</p></div>
<div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-xl p-4 border border-red-200"><div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center mb-2"><i data-lucide="x-circle" class="w-5 h-5 text-white"></i></div><p class="text-2xl font-bold text-red-900 dark:text-red-100" x-text="demandes.filter(d=>d.statut==='Rejeté').length"></p><p class="text-xs text-red-600 font-medium">Rejetés</p></div>
</div>
<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
<div class="p-4 border-b border-gray-200 dark:border-gray-700"><div class="flex gap-2"><button @click="filterStatut=''" :class="filterStatut===''?'bg-indigo-600 text-white':'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'" class="px-4 py-2 rounded-lg text-sm font-medium transition">Tous</button><button @click="filterStatut='En attente'" :class="filterStatut==='En attente'?'bg-orange-600 text-white':'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'" class="px-4 py-2 rounded-lg text-sm font-medium transition">En attente</button><button @click="filterStatut='Approuvé'" :class="filterStatut==='Approuvé'?'bg-green-600 text-white':'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'" class="px-4 py-2 rounded-lg text-sm font-medium transition">Approuvés</button><button @click="filterStatut='Rejeté'" :class="filterStatut==='Rejeté'?'bg-red-600 text-white':'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'" class="px-4 py-2 rounded-lg text-sm font-medium transition">Rejetés</button></div></div>
<div class="p-6 space-y-3">
<template x-for="demande in filteredDemandes" :key="demande.id">
<div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-900 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition">
<div class="flex items-center gap-4 flex-1"><div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-400 to-purple-400 flex items-center justify-center text-white font-bold"><span x-text="demande.employe.split(' ').map(n=>n[0]).join('')"></span></div><div class="flex-1"><h4 class="font-bold text-gray-900 dark:text-white" x-text="demande.employe"></h4><div class="flex items-center gap-3 text-sm text-gray-600 dark:text-gray-400 mt-1"><span class="flex items-center gap-1"><i data-lucide="calendar" class="w-3 h-3"></i><span x-text="demande.dateDebut+' → '+demande.dateFin"></span></span><span class="flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i><span x-text="demande.duree+' jour(s)'"></span></span><span class="px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300" x-text="demande.type"></span></div></div></div>
<div class="flex items-center gap-3"><span class="px-3 py-1 rounded-full text-xs font-semibold" :class="demande.statut==='Approuvé'?'bg-green-100 text-green-700':demande.statut==='Rejeté'?'bg-red-100 text-red-700':'bg-orange-100 text-orange-700'" x-text="demande.statut"></span><button @click.prevent="viewDemande(demande)" class="p-2 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 rounded-lg hover:bg-indigo-100 transition"><i data-lucide="eye" class="w-4 h-4"></i></button></div>
</div>
</template>
</div>
</div>

<!-- Toast Notification -->
<div x-show="toast.show" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0" class="fixed top-4 right-4 z-50 max-w-md" style="display:none;">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 flex items-center gap-3">
        <div :class="toast.type==='success'?'bg-green-100 text-green-600':toast.type==='error'?'bg-red-100 text-red-600':'bg-blue-100 text-blue-600'" class="w-10 h-10 rounded-full flex items-center justify-center">
            <i :data-lucide="toast.type==='success'?'check-circle':'x-circle'" class="w-5 h-5"></i>
        </div>
        <p class="flex-1 text-sm font-medium text-gray-900 dark:text-white" x-text="toast.message"></p>
        <button @click="toast.show=false" class="text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-4 h-4"></i></button>
    </div>
</div>

<!-- Modal Détails Congé -->
<div x-show="modalOpen==='details'" x-transition class="fixed inset-0 z-50 overflow-y-auto" style="display:none;">
    <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" @click="closeModal()"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Détails de la Demande de Congé</h3>
                <button @click="closeModal()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <template x-if="selectedDemande">
                <div class="space-y-6">
                    <div class="flex items-center gap-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-xl">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold text-2xl">
                            <span x-text="selectedDemande.employe.split(' ').map(n=>n[0]).join('')"></span>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-xl font-bold text-gray-900 dark:text-white" x-text="selectedDemande.employe"></h4>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Demande de congé</p>
                        </div>
                        <span class="px-4 py-2 rounded-full text-sm font-bold" :class="selectedDemande.statut==='Approuvé'?'bg-green-100 text-green-700':selectedDemande.statut==='Rejeté'?'bg-red-100 text-red-700':'bg-orange-100 text-orange-700'" x-text="selectedDemande.statut"></span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"><i data-lucide="tag" class="w-4 h-4"></i><span class="text-sm font-medium">Type de congé</span></div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="selectedDemande.type"></p>
                        </div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"><i data-lucide="clock" class="w-4 h-4"></i><span class="text-sm font-medium">Durée</span></div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white"><span x-text="selectedDemande.duree"></span> jour(s)</p>
                        </div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"><i data-lucide="calendar" class="w-4 h-4"></i><span class="text-sm font-medium">Date début</span></div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="selectedDemande.dateDebut"></p>
                        </div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                            <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"><i data-lucide="calendar-check" class="w-4 h-4"></i><span class="text-sm font-medium">Date fin</span></div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white" x-text="selectedDemande.dateFin"></p>
                        </div>
                    </div>
                    <div class="p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
                        <div class="flex items-start gap-3">
                            <i data-lucide="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                            <div>
                                <h5 class="font-bold text-blue-900 dark:text-blue-100 mb-1">Informations</h5>
                                <p class="text-sm text-blue-700 dark:text-blue-300">Solde de congés restant: <span class="font-bold">18 jours</span></p>
                                <p class="text-sm text-blue-700 dark:text-blue-300 mt-1">Congés pris cette année: <span class="font-bold">12 jours</span></p>
                            </div>
                        </div>
                    </div>
                    <template x-if="selectedDemande.statut==='En attente'">
                        <div class="flex gap-3 pt-4">
                            <button @click.prevent="approuverDemande(selectedDemande)" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium flex items-center justify-center gap-2">
                                <i data-lucide="check" class="w-5 h-5"></i>
                                <span>Approuver</span>
                            </button>
                            <button @click.prevent="rejeterDemande(selectedDemande)" class="flex-1 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium flex items-center justify-center gap-2">
                                <i data-lucide="x" class="w-5 h-5"></i>
                                <span>Rejeter</span>
                            </button>
                        </div>
                    </template>
                    <template x-if="selectedDemande.statut!=='En attente'">
                        <div class="flex justify-end pt-4">
                            <button @click="closeModal()" class="px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition font-medium">Fermer</button>
                        </div>
                    </template>
                </div>
            </template>
        </div>
    </div>
</div>

<div x-show="modalOpen==='nouvelle'" x-transition class="fixed inset-0 z-50 overflow-y-auto" style="display:none;"><div class="flex items-center justify-center min-h-screen px-4"><div class="fixed inset-0 bg-black/50 backdrop-blur-sm" @click="closeModal()"></div><div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full p-6"><div class="flex items-center justify-between mb-6"><h3 class="text-2xl font-bold text-gray-900 dark:text-white">Nouvelle Demande de Congé</h3><button @click="closeModal()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"><i data-lucide="x" class="w-5 h-5"></i></button></div><form @submit.prevent="saveDemande()" class="space-y-4"><select required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"><option value="">Sélectionner un employé...</option><option>Jean Kouassi</option><option>Marie Diabaté</option><option>Paul Traoré</option></select><select required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"><option value="">Type de congé...</option><option>Congé annuel</option><option>Congé maladie</option><option>Congé maternité</option><option>Congé sans solde</option></select><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date début</label><input type="date" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"></div><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date fin</label><input type="date" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"></div></div><textarea placeholder="Motif (optionnel)..." rows="3" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 rounded-lg"></textarea><div class="flex justify-end gap-3 pt-4"><button type="button" @click="closeModal()" class="px-6 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 transition">Annuler</button><button type="submit" class="px-6 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">Soumettre</button></div></form></div></div></div>
</div>
{% endblock %}
{% block extra_js %}
<script>
function congesData(){
    return{
        modalOpen:null,
        filterStatut:'',
        toast:{show:false,message:'',type:'success'},
        demandes:[
            {id:1,employe:'Jean Kouassi',type:'Congé annuel',dateDebut:'25/10/2025',dateFin:'05/11/2025',duree:10,statut:'En attente'},
            {id:2,employe:'Marie Diabaté',type:'Congé maladie',dateDebut:'20/10/2025',dateFin:'22/10/2025',duree:3,statut:'Approuvé'},
            {id:3,employe:'Paul Traoré',type:'Congé annuel',dateDebut:'15/11/2025',dateFin:'30/11/2025',duree:15,statut:'En attente'},
            {id:4,employe:'Sophie Koné',type:'Congé sans solde',dateDebut:'01/11/2025',dateFin:'03/11/2025',duree:3,statut:'Rejeté'}
        ],
        get filteredDemandes(){
            return this.filterStatut?this.demandes.filter(d=>d.statut===this.filterStatut):this.demandes;
        },
        init(){
            lucide.createIcons();
        },
        openModal(type){
            this.modalOpen=type;
            this.$nextTick(()=>lucide.createIcons());
        },
        closeModal(){
            this.modalOpen=null;
        },
        showToast(message,type='success'){
            this.toast={show:true,message,type};
            setTimeout(()=>{this.toast.show=false},3000);
            this.$nextTick(()=>lucide.createIcons());
        },
        selectedDemande:null,
        viewDemande(demande){
            this.selectedDemande=demande;
            this.openModal('details');
        },
        approuverDemande(demande){
            demande.statut='Approuvé';
            this.showToast(`✅ Congé approuvé pour ${demande.employe} (${demande.duree} jours)`,'success');
            this.closeModal();
            this.$nextTick(()=>lucide.createIcons());
        },
        rejeterDemande(demande){
            demande.statut='Rejeté';
            this.showToast(`❌ Congé rejeté pour ${demande.employe}`,'error');
            this.closeModal();
            this.$nextTick(()=>lucide.createIcons());
        },
        saveDemande(){
            this.showToast('✅ Demande de congé enregistrée avec succès !','success');
            this.closeModal();
        }
    }
}
</script>
{% endblock %}
