<!-- Toast Notification System -->
<div x-data="toastManager()" 
     @toast.window="showToast($event.detail)"
     class="fixed top-4 right-4 z-[9999] space-y-3 pointer-events-none">
    
    <template x-for="toast in toasts" :key="toast.id">
        <div x-show="toast.visible"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-x-full"
             x-transition:enter-end="opacity-100 translate-x-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 translate-x-0"
             x-transition:leave-end="opacity-0 translate-x-full"
             class="pointer-events-auto max-w-sm w-full bg-white dark:bg-gray-800 rounded-xl shadow-2xl border overflow-hidden"
             :class="{
                 'border-green-200 dark:border-green-800': toast.type === 'success',
                 'border-red-200 dark:border-red-800': toast.type === 'error',
                 'border-blue-200 dark:border-blue-800': toast.type === 'info',
                 'border-orange-200 dark:border-orange-800': toast.type === 'warning'
             }">
            
            <!-- Progress bar -->
            <div class="h-1 bg-gray-200 dark:bg-gray-700">
                <div class="h-full transition-all duration-[3000ms] ease-linear"
                     :class="{
                         'bg-green-500': toast.type === 'success',
                         'bg-red-500': toast.type === 'error',
                         'bg-blue-500': toast.type === 'info',
                         'bg-orange-500': toast.type === 'warning'
                     }"
                     :style="'width: ' + toast.progress + '%'"></div>
            </div>
            
            <div class="p-4 flex items-start space-x-3">
                <!-- Icon -->
                <div class="flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center"
                     :class="{
                         'bg-green-100 dark:bg-green-900/30': toast.type === 'success',
                         'bg-red-100 dark:bg-red-900/30': toast.type === 'error',
                         'bg-blue-100 dark:bg-blue-900/30': toast.type === 'info',
                         'bg-orange-100 dark:bg-orange-900/30': toast.type === 'warning'
                     }">
                    <i :data-lucide="toast.icon"
                       class="w-5 h-5"
                       :class="{
                           'text-green-600 dark:text-green-400': toast.type === 'success',
                           'text-red-600 dark:text-red-400': toast.type === 'error',
                           'text-blue-600 dark:text-blue-400': toast.type === 'info',
                           'text-orange-600 dark:text-orange-400': toast.type === 'warning'
                       }"></i>
                </div>
                
                <!-- Content -->
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-semibold text-gray-900 dark:text-white mb-1" 
                       x-text="toast.title"></p>
                    <p class="text-sm text-gray-600 dark:text-gray-400" 
                       x-text="toast.message"></p>
                </div>
                
                <!-- Close button -->
                <button @click="removeToast(toast.id)"
                        class="flex-shrink-0 p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">
                    <i data-lucide="x" class="w-4 h-4 text-gray-400"></i>
                </button>
            </div>
        </div>
    </template>
</div>

<script>
function toastManager() {
    return {
        toasts: [],
        nextId: 1,
        
        showToast(config) {
            const toast = {
                id: this.nextId++,
                type: config.type || 'info',
                title: config.title || this.getDefaultTitle(config.type),
                message: config.message || '',
                icon: config.icon || this.getDefaultIcon(config.type),
                visible: true,
                progress: 100,
                duration: config.duration || 3000
            };
            
            this.toasts.push(toast);
            
            // Recharger les icônes
            this.$nextTick(() => lucide.createIcons());
            
            // Progress bar animation
            setTimeout(() => {
                toast.progress = 0;
            }, 10);
            
            // Auto-dismiss
            setTimeout(() => {
                this.removeToast(toast.id);
            }, toast.duration);
        },
        
        removeToast(id) {
            const toast = this.toasts.find(t => t.id === id);
            if (toast) {
                toast.visible = false;
                setTimeout(() => {
                    this.toasts = this.toasts.filter(t => t.id !== id);
                }, 300);
            }
        },
        
        getDefaultTitle(type) {
            const titles = {
                success: 'Succès',
                error: 'Erreur',
                info: 'Information',
                warning: 'Attention'
            };
            return titles[type] || 'Notification';
        },
        
        getDefaultIcon(type) {
            const icons = {
                success: 'check-circle',
                error: 'x-circle',
                info: 'info',
                warning: 'alert-triangle'
            };
            return icons[type] || 'bell';
        }
    }
}

// Helper global pour déclencher des toasts
window.showToast = function(message, type = 'info', title = null, duration = 3000) {
    window.dispatchEvent(new CustomEvent('toast', {
        detail: { message, type, title, duration }
    }));
};
</script>
