{% extends "dashboard/base_dashboard.html" %}
{% load static %}

{% block title %}{{ entreprise.nom }} - Walee{% endblock %}

{% block dashboard_content %}
<div x-data="entrepriseDetailData()">
    
    <!-- Header avec retour -->
    <div class="mb-4 sm:mb-6">
        <a href="{% url 'entreprises' %}" class="inline-flex items-center space-x-2 text-gray-600 dark:text-gray-400 hover:text-walee-blue transition mb-3 sm:mb-4">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            <span class="text-sm sm:text-base">Retour aux entreprises</span>
        </a>
        
        <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4">
            <div class="flex items-start space-x-3 sm:space-x-4">
                <!-- Logo/Icône entreprise -->
                <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-2xl flex items-center justify-center text-white text-xl sm:text-2xl font-bold shadow-lg flex-shrink-0"
                     :class="entreprise.gradient">
                    <span x-text="entreprise.initiales"></span>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex flex-wrap items-center gap-2 sm:gap-3 mb-2">
                        <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold font-poppins text-walee-dark dark:text-white truncate" x-text="entreprise.nom"></h1>
                        <span class="px-2.5 sm:px-3 py-1 rounded-full text-xs font-medium flex-shrink-0"
                              :class="entreprise.actif ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400'">
                            <span x-text="entreprise.actif ? 'Active' : 'Inactive'"></span>
                        </span>
                    </div>
                    <div class="flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-600 dark:text-gray-400">
                        <span class="flex items-center space-x-1">
                            <i data-lucide="tag" class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"></i>
                            <span class="truncate" x-text="entreprise.secteur"></span>
                        </span>
                        <span class="flex items-center space-x-1">
                            <i data-lucide="map-pin" class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"></i>
                            <span class="truncate" x-text="entreprise.ville"></span>
                        </span>
                        <span class="hidden sm:flex items-center space-x-1">
                            <i data-lucide="calendar" class="w-4 h-4 flex-shrink-0"></i>
                            <span>Créée le <span x-text="entreprise.dateCreation"></span></span>
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Actions -->
            <div class="flex items-center gap-2 sm:gap-3">
                <button @click="editEntreprise()" 
                        class="flex-1 sm:flex-none flex items-center justify-center space-x-2 px-3 sm:px-4 py-2 bg-walee-blue text-white rounded-lg hover:bg-blue-700 transition text-sm sm:text-base">
                    <i data-lucide="edit" class="w-4 h-4"></i>
                    <span>Modifier</span>
                </button>
                <button @click="showSettings = true" 
                        class="p-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                    <i data-lucide="settings" class="w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-gray-400"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6 mb-6 sm:mb-8">
        <!-- CA du mois -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm hover:shadow-md transition">
            <div class="flex items-center justify-between mb-2 sm:mb-4">
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i data-lucide="dollar-sign" class="w-5 h-5 sm:w-6 sm:h-6 text-green-600 dark:text-green-400"></i>
                </div>
                <span class="text-green-500 text-xs sm:text-sm font-medium" x-text="stats.caEvolution"></span>
            </div>
            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">CA du mois</p>
            <p class="text-lg sm:text-2xl font-bold text-walee-dark dark:text-white truncate" x-text="formatMoney(stats.caMois)"></p>
        </div>
        
        <!-- Ventes -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm hover:shadow-md transition">
            <div class="flex items-center justify-between mb-2 sm:mb-4">
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i data-lucide="shopping-cart" class="w-5 h-5 sm:w-6 sm:h-6 text-blue-600 dark:text-blue-400"></i>
                </div>
                <span class="text-blue-500 text-xs sm:text-sm font-medium" x-text="stats.ventesEvolution"></span>
            </div>
            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Ventes</p>
            <p class="text-lg sm:text-2xl font-bold text-walee-dark dark:text-white" x-text="stats.ventesTotal"></p>
        </div>
        
        <!-- Clients -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm hover:shadow-md transition">
            <div class="flex items-center justify-between mb-2 sm:mb-4">
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i data-lucide="users" class="w-5 h-5 sm:w-6 sm:h-6 text-purple-600 dark:text-purple-400"></i>
                </div>
                <span class="text-purple-500 text-xs sm:text-sm font-medium">+<span x-text="stats.nouveauxClients"></span></span>
            </div>
            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Clients</p>
            <p class="text-lg sm:text-2xl font-bold text-walee-dark dark:text-white" x-text="stats.clientsTotal"></p>
        </div>
        
        <!-- Employés -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm hover:shadow-md transition">
            <div class="flex items-center justify-between mb-2 sm:mb-4">
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-orange-100 dark:bg-orange-900 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i data-lucide="user-check" class="w-5 h-5 sm:w-6 sm:h-6 text-orange-600 dark:text-orange-400"></i>
                </div>
                <span class="text-orange-500 text-xs sm:text-sm font-medium" x-text="stats.employesActifs + ' actifs'"></span>
            </div>
            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Employés</p>
            <p class="text-lg sm:text-2xl font-bold text-walee-dark dark:text-white" x-text="stats.employesTotal"></p>
        </div>
    </div>
    
    <!-- Tabs Navigation -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm mb-4 sm:mb-6">
        <div class="border-b border-gray-200 dark:border-gray-700">
            <nav class="flex space-x-4 sm:space-x-8 px-4 sm:px-6 overflow-x-auto scrollbar-hide" aria-label="Tabs">
                <button @click="activeTab = 'apercu'" 
                        :class="activeTab === 'apercu' ? 'border-walee-blue text-walee-blue' : 'border-transparent text-gray-500 dark:text-gray-400'"
                        class="py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap transition flex items-center space-x-1.5 sm:space-x-2">
                    <i data-lucide="layout-dashboard" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                    <span>Aperçu</span>
                </button>
                <button @click="activeTab = 'ventes'" 
                        :class="activeTab === 'ventes' ? 'border-walee-blue text-walee-blue' : 'border-transparent text-gray-500 dark:text-gray-400'"
                        class="py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap transition flex items-center space-x-1.5 sm:space-x-2">
                    <i data-lucide="trending-up" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                    <span>Ventes</span>
                </button>
                <button @click="activeTab = 'produits'" 
                        :class="activeTab === 'produits' ? 'border-walee-blue text-walee-blue' : 'border-transparent text-gray-500 dark:text-gray-400'"
                        class="py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap transition flex items-center space-x-1.5 sm:space-x-2">
                    <i data-lucide="package" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                    <span x-text="getSecteurLabel('produits')"></span>
                </button>
                <button @click="activeTab = 'clients'" 
                        :class="activeTab === 'clients' ? 'border-walee-blue text-walee-blue' : 'border-transparent text-gray-500 dark:text-gray-400'"
                        class="py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap transition flex items-center space-x-1.5 sm:space-x-2">
                    <i data-lucide="users" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                    <span>Clients</span>
                </button>
                <button @click="activeTab = 'employes'" 
                        :class="activeTab === 'employes' ? 'border-walee-blue text-walee-blue' : 'border-transparent text-gray-500 dark:text-gray-400'"
                        class="py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap transition flex items-center space-x-1.5 sm:space-x-2">
                    <i data-lucide="user-check" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                    <span>Employés</span>
                </button>
                <button @click="activeTab = 'informations'" 
                        :class="activeTab === 'informations' ? 'border-walee-blue text-walee-blue' : 'border-transparent text-gray-500 dark:text-gray-400'"
                        class="py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap transition flex items-center space-x-1.5 sm:space-x-2">
                    <i data-lucide="info" class="w-3.5 h-3.5 sm:w-4 sm:h-4"></i>
                    <span>Informations</span>
                </button>
            </nav>
        </div>
    </div>
    
    <!-- Tab Content: Aperçu -->
    <div x-show="activeTab === 'apercu'" x-transition class="space-y-4 sm:space-y-6">
        
        <!-- Graphiques -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
            <!-- Evolution CA -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
                <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white mb-3 sm:mb-4">Évolution du CA</h3>
                <div class="h-48 sm:h-64">
                    <canvas id="caChart"></canvas>
                </div>
            </div>
            
            <!-- Répartition selon secteur -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
                <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white mb-3 sm:mb-4" x-text="getSecteurChartTitle()"></h3>
                <div class="h-48 sm:h-64">
                    <canvas id="secteurChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Activité récente -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
            <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white mb-3 sm:mb-4">Activité récente</h3>
            <div class="space-y-2 sm:space-y-3">
                <template x-for="activite in activitesRecentes" :key="activite.id">
                    <div class="flex items-center space-x-3 sm:space-x-4 p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-lg flex items-center justify-center flex-shrink-0"
                             :class="activite.iconBg">
                            <i :data-lucide="activite.icon" class="w-4 h-4 sm:w-5 sm:h-5" :class="activite.iconColor"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white truncate" x-text="activite.titre"></p>
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 truncate" x-text="activite.description"></p>
                        </div>
                        <span class="text-xs text-gray-400 dark:text-gray-500 flex-shrink-0" x-text="activite.date"></span>
                    </div>
                </template>
            </div>
        </div>
        
    </div>
    
    <!-- Tab Content: Ventes -->
    <div x-show="activeTab === 'ventes'" x-transition class="space-y-4 sm:space-y-6">
        
        <!-- Filtres -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-3 sm:p-4 shadow-sm">
            <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4">
                <select x-model="ventesFiltre.periode" 
                        class="px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-walee-blue outline-none">
                    <option value="today">Aujourd'hui</option>
                    <option value="week">Cette semaine</option>
                    <option value="month">Ce mois</option>
                    <option value="year">Cette année</option>
                </select>
                <input type="text" 
                       x-model="ventesFiltre.search"
                       placeholder="Rechercher une vente..." 
                       class="flex-1 px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-walee-blue outline-none">
            </div>
        </div>
        
        <!-- Liste des ventes - Mobile View -->
        <div class="block lg:hidden space-y-3">
            <template x-for="vente in filteredVentes" :key="vente.id">
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm" @click="viewVente(vente)">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <p class="font-semibold text-gray-900 dark:text-white" x-text="vente.numero"></p>
                            <p class="text-xs text-gray-500 dark:text-gray-400" x-text="vente.date"></p>
                        </div>
                        <span class="inline-flex px-2.5 py-1 rounded-full text-xs font-medium"
                              :class="vente.statut === 'Payée' ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 'bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300'">
                            <span x-text="vente.statut"></span>
                        </span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Client:</span>
                            <span class="font-medium text-gray-900 dark:text-white" x-text="vente.client"></span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Vendeur:</span>
                            <span class="text-gray-700 dark:text-gray-300" x-text="vente.vendeur"></span>
                        </div>
                        <div class="flex items-center justify-between pt-2 border-t dark:border-gray-700">
                            <span class="text-gray-600 dark:text-gray-400">Montant:</span>
                            <span class="font-bold text-walee-blue" x-text="formatMoney(vente.montant)"></span>
                        </div>
                    </div>
                </div>
            </template>
        </div>
        
        <!-- Liste des ventes - Desktop Table -->
        <div class="hidden lg:block bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">N° Vente</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Client</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Vendeur</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Montant</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Statut</th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        <template x-for="vente in filteredVentes" :key="vente.id">
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                <td class="px-6 py-4">
                                    <p class="font-medium text-gray-900 dark:text-white" x-text="vente.numero"></p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400" x-text="vente.date"></p>
                                </td>
                                <td class="px-6 py-4">
                                    <p class="text-sm text-gray-900 dark:text-white" x-text="vente.client"></p>
                                </td>
                                <td class="px-6 py-4">
                                    <p class="text-sm text-gray-700 dark:text-gray-300" x-text="vente.vendeur"></p>
                                </td>
                                <td class="px-6 py-4">
                                    <p class="font-semibold text-gray-900 dark:text-white" x-text="formatMoney(vente.montant)"></p>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex px-3 py-1 rounded-full text-xs font-medium"
                                          :class="vente.statut === 'Payée' ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 'bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300'">
                                        <span x-text="vente.statut"></span>
                                    </span>
                                </td>
                                <td class="px-6 py-4">
                                    <button @click="viewVente(vente)" 
                                            class="p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition">
                                        <i data-lucide="eye" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>
                                    </button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>
    
    <!-- Tab Content: Produits/Services (adapté au secteur) -->
    <div x-show="activeTab === 'produits'" x-transition class="space-y-4 sm:space-y-6">
        
        <!-- Header avec bouton ajout -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
            <h3 class="text-lg sm:text-xl font-bold text-walee-dark dark:text-white" x-text="getSecteurLabel('produits')"></h3>
            <button @click="addProduit()" 
                    class="flex items-center justify-center space-x-2 px-4 py-2 bg-walee-green text-white rounded-lg hover:bg-emerald-600 transition text-sm sm:text-base">
                <i data-lucide="plus" class="w-4 h-4"></i>
                <span>Ajouter</span>
            </button>
        </div>
        
        <!-- Grille de produits/services -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
            <template x-for="produit in produits" :key="produit.id">
                <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm hover:shadow-md transition cursor-pointer"
                     @click="viewProduit(produit)">
                    <div class="flex items-start justify-between mb-3 sm:mb-4">
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i :data-lucide="getProduitIcon()" class="w-5 h-5 sm:w-6 sm:h-6 text-gray-600 dark:text-gray-400"></i>
                        </div>
                        <span class="px-2 py-1 rounded-full text-xs font-medium"
                              :class="produit.stock > produit.seuilMin ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 'bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300'">
                            <span x-text="produit.stock > produit.seuilMin ? 'En stock' : 'Stock faible'"></span>
                        </span>
                    </div>
                    <h4 class="font-bold text-sm sm:text-base text-gray-900 dark:text-white mb-2 truncate" x-text="produit.nom"></h4>
                    <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mb-3 sm:mb-4 truncate" x-text="produit.reference"></p>
                    <div class="flex items-center justify-between">
                        <span class="text-base sm:text-lg font-bold text-walee-blue truncate" x-text="formatMoney(produit.prix)"></span>
                        <span class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 flex-shrink-0">Stock: <span x-text="produit.stock"></span></span>
                    </div>
                </div>
            </template>
        </div>
        
    </div>
    
    <!-- Tab Content: Clients -->
    <div x-show="activeTab === 'clients'" x-transition class="space-y-4 sm:space-y-6">
        
        <!-- Liste des clients -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4 mb-4 sm:mb-6">
                <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white">Clients de l'entreprise</h3>
                <button @click="addClient()" 
                        class="flex items-center justify-center space-x-2 px-4 py-2 bg-walee-blue text-white rounded-lg hover:bg-blue-700 transition text-sm sm:text-base">
                    <i data-lucide="user-plus" class="w-4 h-4"></i>
                    <span>Nouveau client</span>
                </button>
            </div>
            
            <div class="space-y-2 sm:space-y-3">
                <template x-for="client in clients" :key="client.id">
                    <div class="flex items-center space-x-3 sm:space-x-4 p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition cursor-pointer"
                         @click="viewClient(client)">
                        <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0"
                             :class="client.gradient">
                            <span x-text="client.initiales"></span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white truncate" x-text="client.nom"></p>
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400" x-text="client.telephone"></p>
                        </div>
                        <div class="text-right flex-shrink-0">
                            <p class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white" x-text="formatMoney(client.totalAchats)"></p>
                            <p class="text-xs text-gray-500 dark:text-gray-400" x-text="client.nombreAchats + ' achats'"></p>
                        </div>
                    </div>
                </template>
            </div>
        </div>
        
    </div>
    
    <!-- Tab Content: Employés -->
    <div x-show="activeTab === 'employes'" x-transition class="space-y-4 sm:space-y-6">
        
        <!-- Liste des employés -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4 mb-4 sm:mb-6">
                <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white">Équipe</h3>
                <button @click="addEmploye()" 
                        class="flex items-center justify-center space-x-2 px-4 py-2 bg-walee-blue text-white rounded-lg hover:bg-blue-700 transition text-sm sm:text-base">
                    <i data-lucide="user-plus" class="w-4 h-4"></i>
                    <span>Ajouter un employé</span>
                </button>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                <template x-for="employe in employes" :key="employe.id">
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-3 sm:p-4 hover:shadow-md transition cursor-pointer"
                         @click="viewEmploye(employe)">
                        <div class="flex items-center space-x-2 sm:space-x-3 mb-2 sm:mb-3">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0"
                                 :class="employe.gradient">
                                <span x-text="employe.initiales"></span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white truncate" x-text="employe.nom"></p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 truncate" x-text="employe.role"></p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-xs sm:text-sm">
                            <span class="text-gray-600 dark:text-gray-400 truncate" x-text="employe.telephone"></span>
                            <span class="px-2 py-1 rounded-full text-xs font-medium flex-shrink-0"
                                  :class="employe.actif ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400'">
                                <span x-text="employe.actif ? 'Actif' : 'Inactif'"></span>
                            </span>
                        </div>
                    </div>
                </template>
            </div>
        </div>
        
    </div>
    
    <!-- Tab Content: Informations -->
    <div x-show="activeTab === 'informations'" x-transition class="space-y-4 sm:space-y-6">
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
            
            <!-- Informations générales -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
                <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white mb-4 sm:mb-6">Informations générales</h3>
                <div class="space-y-3 sm:space-y-4">
                    <div class="flex items-start space-x-2 sm:space-x-3">
                        <i data-lucide="building-2" class="w-4 h-4 sm:w-5 sm:h-5 text-gray-400 mt-1 flex-shrink-0"></i>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Nom légal</p>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white break-words" x-text="entreprise.nomLegal"></p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2 sm:space-x-3">
                        <i data-lucide="hash" class="w-4 h-4 sm:w-5 sm:h-5 text-gray-400 mt-1 flex-shrink-0"></i>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">RCCM / N° d'immatriculation</p>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white break-all" x-text="entreprise.rccm"></p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2 sm:space-x-3">
                        <i data-lucide="tag" class="w-4 h-4 sm:w-5 sm:h-5 text-gray-400 mt-1 flex-shrink-0"></i>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Secteur d'activité</p>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white" x-text="entreprise.secteur"></p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2 sm:space-x-3">
                        <i data-lucide="map-pin" class="w-4 h-4 sm:w-5 sm:h-5 text-gray-400 mt-1 flex-shrink-0"></i>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Adresse</p>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white break-words" x-text="entreprise.adresse"></p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2 sm:space-x-3">
                        <i data-lucide="phone" class="w-4 h-4 sm:w-5 sm:h-5 text-gray-400 mt-1 flex-shrink-0"></i>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Téléphone</p>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white" x-text="entreprise.telephone"></p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-2 sm:space-x-3">
                        <i data-lucide="mail" class="w-4 h-4 sm:w-5 sm:h-5 text-gray-400 mt-1 flex-shrink-0"></i>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Email</p>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white break-all" x-text="entreprise.email"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Paramètres spécifiques au secteur -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
                <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white mb-4 sm:mb-6">Paramètres du secteur</h3>
                
                <!-- Pressing -->
                <div x-show="entreprise.secteur === 'Pressing'" class="space-y-3 sm:space-y-4">
                    <div class="p-3 sm:p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white mb-2">Services proposés</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Lavage</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Repassage</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Nettoyage à sec</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Express</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <span class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">Délai standard</span>
                        <span class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white">24-48h</span>
                    </div>
                </div>
                
                <!-- Supermarché -->
                <div x-show="entreprise.secteur === 'Supermarché'" class="space-y-3 sm:space-y-4">
                    <div class="p-3 sm:p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                        <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white mb-2">Catégories de produits</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Alimentation</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Boissons</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Hygiène</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Entretien</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <span class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">Références en stock</span>
                        <span class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white">1,234</span>
                    </div>
                </div>
                
                <!-- Restaurant -->
                <div x-show="entreprise.secteur === 'Restaurant'" class="space-y-3 sm:space-y-4">
                    <div class="p-3 sm:p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                        <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white mb-2">Type de cuisine</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Africaine</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Française</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Fast-food</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <span class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">Capacité</span>
                        <span class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white">50 couverts</span>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <span class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">Horaires</span>
                        <span class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white">11h - 23h</span>
                    </div>
                </div>
                
                <!-- Vente de véhicules -->
                <div x-show="entreprise.secteur === 'Vente de véhicules'" class="space-y-3 sm:space-y-4">
                    <div class="p-3 sm:p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                        <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white mb-2">Types de véhicules</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Voitures</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Motos</span>
                            <span class="px-2.5 sm:px-3 py-1 bg-white dark:bg-gray-700 rounded-full text-xs sm:text-sm">Camions</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <span class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">Véhicules en stock</span>
                        <span class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white">24</span>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <span class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">Garantie standard</span>
                        <span class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white">12 mois</span>
                    </div>
                </div>
                
                <!-- Autres secteurs (générique) -->
                <div x-show="!['Pressing', 'Supermarché', 'Restaurant', 'Vente de véhicules'].includes(entreprise.secteur)" class="space-y-3 sm:space-y-4">
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 text-center">
                            Paramètres spécifiques disponibles selon le secteur d'activité
                        </p>
                    </div>
                </div>
                
            </div>
            
            <!-- Documents -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
                <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white mb-4 sm:mb-6">Documents</h3>
                <div class="space-y-2 sm:space-y-3">
                    <div class="flex items-center justify-between p-3 sm:p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition cursor-pointer">
                        <div class="flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0">
                            <div class="w-8 h-8 sm:w-10 sm:h-10 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i data-lucide="file-text" class="w-4 h-4 sm:w-5 sm:h-5 text-red-600 dark:text-red-400"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white truncate">Registre de commerce</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">PDF • 2.4 MB</p>
                            </div>
                        </div>
                        <button class="p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition flex-shrink-0">
                            <i data-lucide="download" class="w-4 h-4 text-gray-600 dark:text-gray-400"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition cursor-pointer">
                        <div class="flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0">
                            <div class="w-8 h-8 sm:w-10 sm:h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i data-lucide="file-text" class="w-4 h-4 sm:w-5 sm:h-5 text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white truncate">Attestation fiscale</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">PDF • 1.8 MB</p>
                            </div>
                        </div>
                        <button class="p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition flex-shrink-0">
                            <i data-lucide="download" class="w-4 h-4 text-gray-600 dark:text-gray-400"></i>
                        </button>
                    </div>
                </div>
                
                <button class="mt-3 sm:mt-4 w-full flex items-center justify-center space-x-2 px-4 py-2.5 sm:py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                    <i data-lucide="upload" class="w-4 h-4 sm:w-5 sm:h-5 text-gray-400"></i>
                    <span class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">Ajouter un document</span>
                </button>
            </div>
            
            <!-- Paramètres avancés -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm">
                <h3 class="text-base sm:text-lg font-bold text-walee-dark dark:text-white mb-4 sm:mb-6">Paramètres</h3>
                <div class="space-y-3 sm:space-y-4">
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white">TVA</p>
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Taxe sur la valeur ajoutée</p>
                        </div>
                        <span class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white" x-text="entreprise.tva + '%'"></span>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white">Devise</p>
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Monnaie par défaut</p>
                        </div>
                        <span class="font-semibold text-sm sm:text-base text-gray-900 dark:text-white" x-text="entreprise.devise"></span>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div>
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white">Fuseau horaire</p>
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Heure locale</p>
                        </div>
                        <span class="font-semibold text-xs sm:text-base text-gray-900 dark:text-white truncate ml-2" x-text="entreprise.timezone"></span>
                    </div>
                    <div class="flex items-center justify-between p-3 sm:p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-sm sm:text-base text-gray-900 dark:text-white">Notifications</p>
                            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Alertes actives</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer flex-shrink-0">
                            <input type="checkbox" x-model="entreprise.notifications" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-walee-blue"></div>
                        </label>
                    </div>
                </div>
            </div>
            
        </div>
        
    </div>
    
</div>
{% endblock %}

{% block extra_js %}
<script>
function entrepriseDetailData() {
    return {
        activeTab: 'apercu',
        showSettings: false,
        
        // Données entreprise (à remplacer par données réelles du backend)
        entreprise: {
            id: 1,
            nom: 'ACME Corporation',
            nomLegal: 'ACME Corporation SARL',
            initiales: 'AC',
            secteur: 'Supermarché', // Pressing, Supermarché, Restaurant, Vente de véhicules, etc.
            rccm: 'CI-ABJ-2023-B-12345',
            adresse: '123 Boulevard de la République, Abidjan, Côte d\'Ivoire',
            ville: 'Abidjan',
            telephone: '+225 27 XX XX XX XX',
            email: 'contact@acme.ci',
            dateCreation: '15/01/2023',
            actif: true,
            tva: 18,
            devise: 'FCFA',
            timezone: 'Africa/Abidjan',
            notifications: true,
            gradient: 'bg-gradient-to-br from-walee-blue to-walee-indigo'
        },
        
        stats: {
            caMois: 5200000,
            caEvolution: '+15.3%',
            ventesTotal: 156,
            ventesEvolution: '+8.2%',
            clientsTotal: 89,
            nouveauxClients: 12,
            employesTotal: 8,
            employesActifs: 6
        },
        
        activitesRecentes: [
            { id: 1, titre: 'Nouvelle vente', description: 'VNT-001 • 125,000 FCFA', date: 'Il y a 5 min', icon: 'shopping-cart', iconBg: 'bg-green-100 dark:bg-green-900', iconColor: 'text-green-600 dark:text-green-400' },
            { id: 2, titre: 'Produit ajouté', description: 'Laptop HP Pavilion', date: 'Il y a 1h', icon: 'package', iconBg: 'bg-blue-100 dark:bg-blue-900', iconColor: 'text-blue-600 dark:text-blue-400' },
            { id: 3, titre: 'Nouveau client', description: 'Jean Kouassi', date: 'Il y a 2h', icon: 'user-plus', iconBg: 'bg-purple-100 dark:bg-purple-900', iconColor: 'text-purple-600 dark:text-purple-400' }
        ],
        
        ventes: [
            { id: 1, numero: 'VNT-001', date: 'Aujourd\'hui 14:30', client: 'Jean Kouassi', vendeur: 'Marie Martin', montant: 125000, statut: 'Payée' },
            { id: 2, numero: 'VNT-002', date: 'Aujourd\'hui 13:15', client: 'Fatou Diallo', vendeur: 'Jean Dupont', montant: 89500, statut: 'En attente' },
            { id: 3, numero: 'VNT-003', date: 'Hier 16:20', client: 'Yao Brou', vendeur: 'Sophie Laurent', montant: 245000, statut: 'Payée' }
        ],
        
        produits: [
            { id: 1, nom: 'Laptop HP Pavilion', reference: 'PRD-001', prix: 450000, stock: 15, seuilMin: 10 },
            { id: 2, nom: 'iPhone 13 Pro', reference: 'PRD-002', prix: 650000, stock: 8, seuilMin: 10 },
            { id: 3, nom: 'Samsung Galaxy S23', reference: 'PRD-003', prix: 550000, stock: 5, seuilMin: 10 }
        ],
        
        clients: [
            { id: 1, nom: 'Jean Kouassi', initiales: 'JK', telephone: '+225 07 XX XX', totalAchats: 5600000, nombreAchats: 45, gradient: 'bg-gradient-to-br from-walee-blue to-walee-indigo' },
            { id: 2, nom: 'Fatou Diallo', initiales: 'FD', telephone: '+225 05 XX XX', totalAchats: 4200000, nombreAchats: 38, gradient: 'bg-gradient-to-br from-purple-500 to-pink-600' },
            { id: 3, nom: 'Yao Brou', initiales: 'YB', telephone: '+225 01 XX XX', totalAchats: 3800000, nombreAchats: 32, gradient: 'bg-gradient-to-br from-green-500 to-emerald-600' }
        ],
        
        employes: [
            { id: 1, nom: 'Marie Martin', initiales: 'MM', role: 'Gérante', telephone: '+225 07 XX XX', actif: true, gradient: 'bg-gradient-to-br from-walee-blue to-walee-indigo' },
            { id: 2, nom: 'Jean Dupont', initiales: 'JD', role: 'Caissier', telephone: '+225 05 XX XX', actif: true, gradient: 'bg-gradient-to-br from-green-500 to-emerald-600' },
            { id: 3, nom: 'Sophie Laurent', initiales: 'SL', role: 'Vendeuse', telephone: '+225 01 XX XX', actif: true, gradient: 'bg-gradient-to-br from-purple-500 to-pink-600' },
            { id: 4, nom: 'Pierre Dubois', initiales: 'PD', role: 'Magasinier', telephone: '+225 09 XX XX', actif: false, gradient: 'bg-gradient-to-br from-gray-400 to-gray-600' }
        ],
        
        ventesFiltre: {
            periode: 'month',
            search: ''
        },
        
        get filteredVentes() {
            return this.ventes.filter(v => {
                if (!this.ventesFiltre.search) return true;
                return v.numero.toLowerCase().includes(this.ventesFiltre.search.toLowerCase()) ||
                       v.client.toLowerCase().includes(this.ventesFiltre.search.toLowerCase());
            });
        },
        
        init() {
            this.$nextTick(() => {
                this.initCharts();
            });
        },
        
        initCharts() {
            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#9CA3AF' : '#6B7280';
            const gridColor = isDark ? '#374151' : '#E5E7EB';
            
            // CA Chart
            const caCtx = document.getElementById('caChart');
            if (caCtx) {
                new Chart(caCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin'],
                        datasets: [{
                            label: 'CA (FCFA)',
                            data: [3200000, 3800000, 4100000, 4500000, 4800000, 5200000],
                            borderColor: '#2563EB',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => (ctx.parsed.y / 1000000).toFixed(1) + 'M FCFA'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: gridColor },
                                ticks: {
                                    color: textColor,
                                    callback: (val) => (val / 1000000).toFixed(1) + 'M'
                                }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: textColor }
                            }
                        }
                    }
                });
            }
            
            // Secteur Chart (adapté au type d'entreprise)
            const secteurCtx = document.getElementById('secteurChart');
            if (secteurCtx) {
                const chartData = this.getSecteurChartData();
                new Chart(secteurCtx, {
                    type: 'doughnut',
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            data: chartData.data,
                            backgroundColor: ['#2563EB', '#10B981', '#F59E0B', '#8B5CF6', '#EF4444'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: textColor,
                                    padding: 12,
                                    usePointStyle: true,
                                    font: {
                                        size: window.innerWidth < 640 ? 10 : 12
                                    }
                                }
                            }
                        },
                        cutout: '65%'
                    }
                });
            }
        },
        
        getSecteurLabel(context) {
            const labels = {
                'Pressing': {
                    produits: 'Services'
                },
                'Restaurant': {
                    produits: 'Menu'
                },
                'Vente de véhicules': {
                    produits: 'Véhicules'
                },
                'Supermarché': {
                    produits: 'Produits'
                }
            };
            
            return labels[this.entreprise.secteur]?.[context] || 'Produits';
        },
        
        getSecteurChartTitle() {
            const titles = {
                'Pressing': 'Répartition par service',
                'Restaurant': 'Répartition par catégorie',
                'Vente de véhicules': 'Répartition par type',
                'Supermarché': 'Répartition par rayon'
            };
            return titles[this.entreprise.secteur] || 'Répartition des ventes';
        },
        
        getSecteurChartData() {
            const data = {
                'Pressing': {
                    labels: ['Lavage', 'Repassage', 'Nettoyage à sec', 'Express', 'Retouches'],
                    data: [35, 25, 20, 15, 5]
                },
                'Restaurant': {
                    labels: ['Plats', 'Boissons', 'Desserts', 'Entrées', 'Menu du jour'],
                    data: [40, 25, 15, 10, 10]
                },
                'Vente de véhicules': {
                    labels: ['Voitures', 'Motos', 'Camions', 'Pièces', 'Services'],
                    data: [50, 20, 15, 10, 5]
                },
                'Supermarché': {
                    labels: ['Alimentation', 'Boissons', 'Hygiène', 'Entretien', 'Autres'],
                    data: [35, 25, 20, 15, 5]
                }
            };
            
            return data[this.entreprise.secteur] || {
                labels: ['Catégorie 1', 'Catégorie 2', 'Catégorie 3', 'Autres'],
                data: [40, 30, 20, 10]
            };
        },
        
        getProduitIcon() {
            const icons = {
                'Pressing': 'shirt',
                'Restaurant': 'utensils',
                'Vente de véhicules': 'car',
                'Supermarché': 'shopping-bag'
            };
            return icons[this.entreprise.secteur] || 'package';
        },
        
        async editEntreprise() {
            showToast(
                'Fonctionnalité à venir :<br>' +
                '• Modifier les informations de l\'entreprise<br>' +
                '• Changer le logo<br>' +
                '• Mettre à jour les paramètres',
                'info',
                '✏️ Modification de l\'entreprise',
                5000
            );
        },
        
        async viewVente(vente) {
            showLoading('Chargement des détails...');
            
            try {
                // Simuler un délai de chargement
                await new Promise(resolve => setTimeout(resolve, 800));
                
                showToast(
                    `Client: <strong>${vente.client}</strong><br>` +
                    `Montant: <strong>${this.formatMoney(vente.montant)}</strong><br>` +
                    `Vendeur: <strong>${vente.vendeur}</strong><br>` +
                    `Statut: <span class="${vente.statut === 'Payée' ? 'text-green-600 dark:text-green-400' : 'text-yellow-600 dark:text-yellow-400'}">${vente.statut}</span>`,
                    'info',
                    `📋 Vente ${vente.numero}`,
                    6000
                );
            } finally {
                hideLoading();
            }
        },
        
        async viewProduit(produit) {
            const stockClass = produit.stock <= produit.seuilMin ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400';
            
            showToast(
                `Prix: <strong>${this.formatMoney(produit.prix)}</strong><br>` +
                `Stock: <span class="${stockClass}"><strong>${produit.stock}</strong> unités</span><br>` +
                `Seuil minimum: <strong>${produit.seuilMin}</strong> unités`,
                'info',
                `📦 ${produit.nom}`,
                5000
            );
        },
        
        async viewClient(client) {
            showLoading('Chargement des détails...');
            
            try {
                // Simuler un délai de chargement
                await new Promise(resolve => setTimeout(resolve, 600));
                
                showToast(
                    `Téléphone: <strong>${client.telephone}</strong><br>` +
                    `Total des achats: <strong>${this.formatMoney(client.totalAchats)}</strong><br>` +
                    `Nombre d'achats: <strong>${client.nombreAchats}</strong>`,
                    'info',
                    `👤 ${client.nom}`,
                    5000
                );
            } finally {
                hideLoading();
            }
        },
        
        async viewEmploye(employe) {
            const statusClass = employe.actif ? 'text-green-600 dark:text-green-400' : 'text-gray-500 dark:text-gray-400';
            
            showToast(
                `Rôle: <strong>${employe.role}</strong><br>` +
                `Téléphone: <strong>${employe.telephone}</strong><br>` +
                `Statut: <span class="${statusClass}"><strong>${employe.actif ? 'Actif' : 'Inactif'}</strong></span>`,
                'info',
                `👨‍💼 ${employe.nom}`,
                5000
            );
        },
        
        addProduit() {
            showToast(
                `Fonctionnalité à venir :<br>` +
                `• Ajouter un nouveau ${this.getSecteurLabel('produits').toLowerCase()}<br>` +
                `• Définir le prix et le stock<br>` +
                `• Ajouter une description et des images`,
                'info',
                `➕ Ajouter ${this.getSecteurLabel('produits')}`,
                5000
            );
        },
        
        addClient() {
            showToast(
                'Fonctionnalité à venir :<br>' +
                '• Ajouter un nouveau client<br>' +
                '• Enregistrer ses coordonnées<br>' +
                '• Définir ses préférences',
                'info',
                '➕ Ajouter un client',
                5000
            );
        },
        
        addEmploye() {
            showToast(
                'Fonctionnalité à venir :<br>' +
                '• Ajouter un nouvel employé<br>' +
                '• Définir son rôle et ses permissions<br>' +
                '• Configurer ses identifiants',
                'info',
                '➕ Ajouter un employé',
                5000
            );
        },
        
        formatMoney(amount) {
            if (amount >= 1000000) {
                return (amount / 1000000).toFixed(1) + 'M FCFA';
            }
            return new Intl.NumberFormat('fr-FR').format(amount) + ' FCFA';
        }
    }
}
</script>
{% endblock %}