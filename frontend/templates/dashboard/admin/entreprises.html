{% extends "dashboard/base_dashboard.html" %}
{% load static %}

{% block title %}Mes Entreprises - Walee{% endblock %}

{% block dashboard_content %}
<div x-data="entreprisesData()">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
        <div>
            <h1 class="text-3xl font-bold font-poppins text-walee-dark dark:text-white mb-2">
                Mes Entreprises
            </h1>
            <p class="text-gray-600 dark:text-gray-400">Gérez toutes vos entreprises depuis un seul endroit</p>
        </div>
        <button @click="showCreateModal = true; currentStep = 1" 
                class="flex items-center space-x-2 px-6 py-3 bg-walee-blue text-white font-semibold rounded-xl hover:bg-blue-700 transform hover:scale-105 transition">
            <i data-lucide="plus" class="w-5 h-5"></i>
            <span>Nouvelle entreprise</span>
        </button>
    </div>
    
    <!-- Entreprises Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <!-- Entreprise Card Template -->
        <template x-for="entreprise in entreprises" :key="entreprise.id">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm hover:shadow-lg transition"
                 :class="entreprise.active ? 'border-2 border-walee-blue' : ''">
                <div class="flex items-start justify-between mb-4">
                    <!-- Logo ou Initiales -->
                    <div class="w-16 h-16 rounded-xl flex items-center justify-center text-white text-2xl font-bold"
                         :class="entreprise.logo ? '' : 'bg-gradient-to-br ' + entreprise.gradient">
                        <template x-if="entreprise.logo">
                            <img :src="entreprise.logo" :alt="entreprise.nom" class="w-full h-full object-cover rounded-xl">
                        </template>
                        <template x-if="!entreprise.logo">
                            <span x-text="entreprise.initiales"></span>
                        </template>
                    </div>
                    <span class="px-3 py-1 text-xs font-medium rounded-full"
                          :class="entreprise.active ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300' : 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300'">
                        <span x-text="entreprise.active ? 'Active' : 'Inactive'"></span>
                    </span>
                </div>
                
                <h3 class="text-xl font-bold font-poppins text-walee-dark dark:text-white mb-2" x-text="entreprise.nom"></h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
                    <span x-text="entreprise.type"></span> • <span x-text="entreprise.ville + ', ' + entreprise.pays"></span>
                </p>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Employés</p>
                        <p class="text-lg font-semibold text-walee-dark dark:text-white" x-text="entreprise.employes"></p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Produits</p>
                        <p class="text-lg font-semibold text-walee-dark dark:text-white" x-text="entreprise.produits"></p>
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    <button @click="selectEntreprise(entreprise)" 
                            class="flex-1 px-4 py-2 rounded-lg transition text-sm font-medium"
                            :class="entreprise.active ? 'bg-walee-blue text-white hover:bg-blue-700' : 'border-2 border-walee-blue text-walee-blue hover:bg-blue-50 dark:hover:bg-gray-700'">
                        <span x-text="entreprise.active ? 'Tableau de bord' : 'Ouvrir'"></span>
                    </button>
                    <button @click="editEntreprise(entreprise)" 
                            class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                        <i data-lucide="settings" class="w-4 h-4 text-gray-600 dark:text-gray-300"></i>
                    </button>
                </div>
            </div>
        </template>
        
        <!-- Add New Card (Premium) -->
        <div class="bg-gradient-to-br from-walee-green to-emerald-600 rounded-2xl p-6 text-white relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"></div>
            
            <div class="relative z-10">
                <div class="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center mb-4">
                    <i data-lucide="crown" class="w-8 h-8"></i>
                </div>
                
                <h3 class="text-xl font-bold font-poppins mb-2">
                    Passez en Premium
                </h3>
                <p class="text-sm text-white/90 mb-6">
                    Gérez jusqu'à 10 entreprises et débloquez toutes les fonctionnalités
                </p>
                
                <button class="w-full px-4 py-3 bg-white text-walee-green font-semibold rounded-lg hover:bg-gray-100 transition">
                    Découvrir Premium
                </button>
            </div>
        </div>
        
    </div>
    
    <!-- Create Modal with Stepper -->
    <div x-show="showCreateModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"
         @click.self="showCreateModal = false">
        
        <div x-show="showCreateModal"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-90"
             x-transition:enter-end="opacity-100 scale-100"
             class="bg-white dark:bg-gray-800 rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
            
            <!-- Modal Header -->
            <div class="sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex items-center justify-between z-10">
                <h2 class="text-2xl font-bold font-poppins text-walee-dark dark:text-white">Créer une entreprise</h2>
                <button @click="showCreateModal = false" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i data-lucide="x" class="w-6 h-6 text-gray-600 dark:text-gray-300"></i>
                </button>
            </div>
            
            <!-- Stepper -->
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between max-w-2xl mx-auto">
                    <!-- Step 1 -->
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold transition"
                             :class="currentStep >= 1 ? 'bg-walee-blue text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-500'">
                            1
                        </div>
                        <span class="ml-2 text-sm font-medium hidden sm:inline" 
                              :class="currentStep >= 1 ? 'text-walee-dark dark:text-white' : 'text-gray-500'">
                            Informations
                        </span>
                    </div>
                    <div class="flex-1 h-1 mx-4" :class="currentStep >= 2 ? 'bg-walee-blue' : 'bg-gray-200 dark:bg-gray-700'"></div>
                    
                    <!-- Step 2 -->
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold transition"
                             :class="currentStep >= 2 ? 'bg-walee-blue text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-500'">
                            2
                        </div>
                        <span class="ml-2 text-sm font-medium hidden sm:inline"
                              :class="currentStep >= 2 ? 'text-walee-dark dark:text-white' : 'text-gray-500'">
                            Logo
                        </span>
                    </div>
                    <div class="flex-1 h-1 mx-4" :class="currentStep >= 3 ? 'bg-walee-blue' : 'bg-gray-200 dark:bg-gray-700'"></div>
                    
                    <!-- Step 3 -->
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold transition"
                             :class="currentStep >= 3 ? 'bg-walee-blue text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-500'">
                            3
                        </div>
                        <span class="ml-2 text-sm font-medium hidden sm:inline"
                              :class="currentStep >= 3 ? 'text-walee-dark dark:text-white' : 'text-gray-500'">
                            Détails
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Modal Body -->
            <form @submit.prevent="handleSubmit()" class="p-6">
                
                <!-- Step 1: Informations de Base -->
                <div x-show="currentStep === 1" class="space-y-6">
                    
                    <!-- Nom de l'entreprise -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Nom de l'entreprise *
                        </label>
                        <input type="text" 
                               x-model="formData.nom"
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                               placeholder="Ma Super Entreprise"
                               required>
                    </div>
                    
                    <!-- Type d'activité -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Type d'activité *
                        </label>
                        <select x-model="formData.type"
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                                required>
                            <option value="">Sélectionnez un type</option>
                            <option value="commerce_detail">Commerce de détail</option>
                            <option value="commerce_gros">Commerce de gros</option>
                            <option value="restauration">Restauration</option>
                            <option value="hotellerie">Hôtellerie</option>
                            <option value="services">Services</option>
                            <option value="electronique">Électronique</option>
                            <option value="textile">Textile et habillement</option>
                            <option value="alimentation">Alimentation</option>
                            <option value="construction">Construction</option>
                            <option value="transport">Transport</option>
                            <option value="sante">Santé</option>
                            <option value="education">Éducation</option>
                            <option value="agriculture">Agriculture</option>
                            <option value="immobilier">Immobilier</option>
                            <option value="technologie">Technologie</option>
                            <option value="autre">Autre (à préciser)</option>
                        </select>
                    </div>
                    
                    <!-- Champ "Autre" conditionnel -->
                    <div x-show="formData.type === 'autre'" x-transition>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Précisez votre activité *
                        </label>
                        <input type="text" 
                               x-model="formData.autreActivite"
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                               placeholder="Ex: Conseil en marketing digital">
                    </div>
                    
                    <!-- Localisation -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Ville *
                            </label>
                            <input type="text" 
                                   x-model="formData.ville"
                                   class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                                   placeholder="Abidjan"
                                   required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Pays *
                            </label>
                            <select x-model="formData.pays"
                                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                                    required>
                                <option value="">Sélectionnez</option>
                                <optgroup label="Afrique de l'Ouest">
                                    <option value="BJ">Bénin</option>
                                    <option value="BF">Burkina Faso</option>
                                    <option value="CI">Côte d'Ivoire</option>
                                    <option value="GH">Ghana</option>
                                    <option value="GN">Guinée</option>
                                    <option value="ML">Mali</option>
                                    <option value="NE">Niger</option>
                                    <option value="NG">Nigeria</option>
                                    <option value="SN">Sénégal</option>
                                    <option value="TG">Togo</option>
                                </optgroup>
                                <optgroup label="Afrique Centrale">
                                    <option value="CM">Cameroun</option>
                                    <option value="CF">République Centrafricaine</option>
                                    <option value="TD">Tchad</option>
                                    <option value="CG">Congo</option>
                                    <option value="CD">RD Congo</option>
                                    <option value="GA">Gabon</option>
                                </optgroup>
                                <optgroup label="Afrique de l'Est">
                                    <option value="KE">Kenya</option>
                                    <option value="TZ">Tanzanie</option>
                                    <option value="UG">Ouganda</option>
                                    <option value="RW">Rwanda</option>
                                    <option value="ET">Éthiopie</option>
                                </optgroup>
                                <optgroup label="Afrique du Nord">
                                    <option value="DZ">Algérie</option>
                                    <option value="EG">Égypte</option>
                                    <option value="MA">Maroc</option>
                                    <option value="TN">Tunisie</option>
                                </optgroup>
                                <optgroup label="Afrique Australe">
                                    <option value="ZA">Afrique du Sud</option>
                                    <option value="BW">Botswana</option>
                                    <option value="NA">Namibie</option>
                                </optgroup>
                                <optgroup label="Autres">
                                    <option value="FR">France</option>
                                    <option value="US">États-Unis</option>
                                    <option value="CA">Canada</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Devise -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Devise *
                        </label>
                        <select x-model="formData.devise"
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                                required>
                            <option value="">Sélectionnez</option>
                            <optgroup label="Devises Africaines">
                                <option value="XOF">Franc CFA (BCEAO) - FCFA</option>
                                <option value="XAF">Franc CFA (BEAC) - FCFA</option>
                                <option value="NGN">Naira nigérian - ₦</option>
                                <option value="GHS">Cedi ghanéen - GH₵</option>
                                <option value="KES">Shilling kényan - KSh</option>
                                <option value="ZAR">Rand sud-africain - R</option>
                                <option value="EGP">Livre égyptienne - E£</option>
                                <option value="MAD">Dirham marocain - DH</option>
                                <option value="TND">Dinar tunisien - DT</option>
                                <option value="DZD">Dinar algérien - DA</option>
                            </optgroup>
                            <optgroup label="Devises Internationales">
                                <option value="EUR">Euro - €</option>
                                <option value="USD">Dollar américain - $</option>
                                <option value="GBP">Livre sterling - £</option>
                                <option value="CAD">Dollar canadien - C$</option>
                            </optgroup>
                        </select>
                    </div>
                    
                </div>
                
                <!-- Step 2: Logo -->
                <div x-show="currentStep === 2" class="space-y-6">
                    
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold font-poppins text-walee-dark dark:text-white mb-2">
                            Logo de votre entreprise
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400">
                            Ajoutez un logo ou utilisez vos initiales par défaut
                        </p>
                    </div>
                    
                    <!-- Upload Zone -->
                    <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-2xl p-8 text-center hover:border-walee-blue dark:hover:border-walee-green transition"
                         @dragover.prevent="isDragging = true"
                         @dragleave.prevent="isDragging = false"
                         @drop.prevent="handleFileDrop($event)"
                         :class="isDragging ? 'border-walee-blue bg-blue-50 dark:bg-blue-900/20' : ''">
                        
                        <!-- Preview -->
                        <div x-show="logoPreview" class="mb-4">
                            <img :src="logoPreview" alt="Preview" class="w-32 h-32 mx-auto rounded-xl object-cover shadow-lg">
                        </div>
                        
                        <!-- Default Initiales -->
                        <div x-show="!logoPreview" class="mb-4">
                            <div class="w-32 h-32 mx-auto bg-gradient-to-br from-walee-blue to-walee-indigo rounded-xl flex items-center justify-center text-white text-4xl font-bold">
                                <span x-text="getInitiales(formData.nom)"></span>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <i data-lucide="upload-cloud" class="w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-2"></i>
                            <p class="text-gray-600 dark:text-gray-400 mb-2">
                                <span class="text-walee-blue dark:text-walee-green font-medium">Cliquez pour uploader</span> ou glissez-déposez
                            </p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                PNG, JPG, SVG jusqu'à 5MB
                            </p>
                        </div>
                        
                        <input type="file" 
                               @change="handleFileSelect($event)"
                               accept="image/png,image/jpeg,image/svg+xml"
                               class="hidden"
                               id="logoUpload">
                        <label for="logoUpload" 
                               class="inline-block px-6 py-3 bg-walee-blue text-white font-semibold rounded-xl hover:bg-blue-700 cursor-pointer transition">
                            Choisir un fichier
                        </label>
                        
                        <button x-show="logoPreview" 
                                @click.prevent="logoPreview = null; formData.logo = null"
                                type="button"
                                class="ml-3 px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                            Supprimer
                        </button>
                    </div>
                    
                </div>
                
                <!-- Step 3: Détails Optionnels -->
                <div x-show="currentStep === 3" class="space-y-6">
                    
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold font-poppins text-walee-dark dark:text-white mb-2">
                            Informations complémentaires
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400">
                            Ces informations sont optionnelles
                        </p>
                    </div>
                    
                    <!-- Contact -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Email
                            </label>
                            <input type="email" 
                                   x-model="formData.email"
                                   class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                                   placeholder="contact@entreprise.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Téléphone
                            </label>
                            <input type="tel" 
                                   x-model="formData.telephone"
                                   class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                                   placeholder="+225 XX XX XX XX XX">
                        </div>
                    </div>
                    
                    <!-- Numéro d'enregistrement -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Numéro RCCM / SIRET
                        </label>
                        <input type="text" 
                               x-model="formData.numeroRegistre"
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                               placeholder="CI-ABJ-01-2024-BXXXX">
                    </div>
                    
                    <!-- Site web -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Site web
                        </label>
                        <input type="url" 
                               x-model="formData.siteWeb"
                               class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none"
                               placeholder="https://www.monentreprise.com">
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Description
                        </label>
                        <textarea x-model="formData.description"
                                  rows="4"
                                  class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none resize-none"
                                  placeholder="Décrivez votre entreprise..."></textarea>
                    </div>
                    
                </div>
                
                <!-- Navigation Buttons -->
                <div class="flex justify-between pt-6 mt-6 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" 
                            @click="currentStep > 1 ? currentStep-- : showCreateModal = false"
                            class="px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                        <span x-text="currentStep === 1 ? 'Annuler' : 'Précédent'"></span>
                    </button>
                    
                    <button type="button" 
                            @click="currentStep < 3 ? currentStep++ : handleSubmit()"
                            class="px-6 py-3 bg-walee-blue text-white font-semibold rounded-xl hover:bg-blue-700 transition">
                        <span x-text="currentStep === 3 ? 'Créer l\'entreprise' : 'Suivant'"></span>
                    </button>
                </div>
                
            </form>
            
        </div>
    </div>
    
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/data.js' %}"></script>
<script>
function entreprisesData() {
    return {
        showCreateModal: false,
        currentStep: 1,
        isDragging: false,
        logoPreview: null,
        formData: {
            nom: '',
            type: '',
            autreActivite: '',
            ville: '',
            pays: '',
            devise: '',
            email: '',
            telephone: '',
            numeroRegistre: '',
            siteWeb: '',
            description: '',
            logo: null
        },
        entreprises: [
            {
                id: 1,
                nom: 'ACME Corporation',
                initiales: 'AC',
                type: 'Commerce',
                ville: 'Abidjan',
                pays: 'Côte d\'Ivoire',
                employes: 12,
                produits: 234,
                active: true,
                logo: null,
                gradient: 'from-walee-blue to-walee-indigo'
            },
            {
                id: 2,
                nom: 'Tech Boutique',
                initiales: 'TB',
                type: 'Électronique',
                ville: 'Yamoussoukro',
                pays: 'Côte d\'Ivoire',
                employes: 5,
                produits: 89,
                active: false,
                logo: null,
                gradient: 'from-purple-500 to-pink-600'
            },
            {
                id: 3,
                nom: 'Restaurant Saveurs',
                initiales: 'RS',
                type: 'Restauration',
                ville: 'Bouaké',
                pays: 'Côte d\'Ivoire',
                employes: 8,
                produits: 45,
                active: false,
                logo: null,
                gradient: 'from-orange-500 to-red-600'
            }
        ],
        
        getInitiales(nom) {
            if (!nom) return '??';
            const mots = nom.trim().split(' ');
            if (mots.length === 1) {
                return mots[0].substring(0, 2).toUpperCase();
            }
            return (mots[0][0] + mots[1][0]).toUpperCase();
        },
        
        handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                this.processFile(file);
            }
        },
        
        handleFileDrop(event) {
            this.isDragging = false;
            const file = event.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                this.processFile(file);
            }
        },
        
        processFile(file) {
            // Vérifier le type de fichier
            if (!file.type.startsWith('image/')) {
                showToast('Veillez sélectionner un fichier image valide (JPG, PNG, etc.)', 'error', 'Format non supporté');
                return;
            }
            
            // Vérifier la taille (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                showToast('Le fichier est trop volumineux. La taille maximale est de 5 Mo.', 'error', 'Fichier trop volumineux');
                return;
            }
            
            // Afficher un indicateur de chargement
            showLoading('Traitement de l\'image...');
            
            // Créer preview
            const reader = new FileReader();
            reader.onload = (e) => {
                this.logoPreview = e.target.result;
                this.formData.logo = file;
                hideLoading();
                showToast('Image chargée avec succès', 'success', null, 3000);
            };
            
            reader.onerror = () => {
                hideLoading();
                showToast('Erreur lors du chargement de l\'image', 'error');
            };
            
            reader.readAsDataURL(file);
        },
        
        async selectEntreprise(entreprise) {
            showLoading('Chargement de l\'entreprise...');
            
            try {
                // Simuler un délai de chargement
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Rediriger vers la vue détaillée de l'entreprise
                window.location.href = `/dashboard/entreprises/${entreprise.id}/`;
                
            } catch (error) {
                showToast(
                    'Impossible de charger l\'entreprise sélectionnée',
                    'error',
                    'Erreur de chargement',
                    5000
                );
            } finally {
                hideLoading();
            }
        },
        
        async editEntreprise(entreprise) {
            // Afficher un toast informatif
            showToast(
                `Fonctionnalité à venir :<br>` +
                `• Modifier les informations<br>` +
                `• Changer le logo<br>` +
                `• Gérer les paramètres<br>` +
                `• Supprimer l'entreprise`,
                'info',
                `Modification de "${entreprise.nom}"`,
                5000
            );
            
            // TODO: Implémenter modal d'édition
            // this.showEditModal = true;
            // this.editingEntreprise = entreprise;
        },
        
        async handleSubmit() {
            // Validation des champs obligatoires
            if (!this.formData.nom) {
                showToast('Veuillez saisir le nom de l\'entreprise', 'warning', 'Champ requis');
                return;
            }
            
            if (!this.formData.type) {
                showToast('Veuillez sélectionner un type d\'entreprise', 'warning', 'Champ requis');
                return;
            }
            
            if (this.formData.type === 'autre' && !this.formData.autreActivite) {
                showToast('Veuillez préciser le type d\'activité', 'warning', 'Champ requis');
                return;
            }
            
            showLoading('Création de l\'entreprise...');
            
            try {
                // Simuler un délai réseau
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Créer nouvelle entreprise
                const nouvelleEntreprise = {
                    id: this.entreprises.length + 1,
                    nom: this.formData.nom,
                    initiales: this.getInitiales(this.formData.nom),
                    type: this.formData.type === 'autre' ? this.formData.autreActivite : this.formData.type,
                    ville: this.formData.ville,
                    pays: this.getPaysNom(this.formData.pays),
                    employes: 0,
                    produits: 0,
                    active: false,
                    logo: this.logoPreview,
                    gradient: this.getRandomGradient()
                };
                
                this.entreprises.push(nouvelleEntreprise);
                
                // Afficher un message de succès
                showToast(
                    `L'entreprise a été créée avec succès.`,
                    'success',
                    'Entreprise créée',
                    5000
                );
                
                // Reset et fermer
                this.showCreateModal = false;
                this.currentStep = 1;
                this.resetForm();
                
            } catch (error) {
                showToast(
                    'Une erreur est survenue lors de la création de l\'entreprise',
                    'error',
                    'Erreur',
                    5000
                );
            } finally {
                hideLoading();
            }
        },
        
        getPaysNom(code) {
            const paysMap = {
                'CI': 'Côte d\'Ivoire',
                'SN': 'Sénégal',
                'BF': 'Burkina Faso',
                'ML': 'Mali',
                'FR': 'France',
                // Ajoutez plus si nécessaire
            };
            return paysMap[code] || code;
        },
        
        getRandomGradient() {
            const gradients = [
                'from-blue-500 to-indigo-600',
                'from-green-500 to-emerald-600',
                'from-purple-500 to-pink-600',
                'from-orange-500 to-red-600',
                'from-teal-500 to-cyan-600',
                'from-yellow-500 to-orange-600'
            ];
            return gradients[Math.floor(Math.random() * gradients.length)];
        },
        
        resetForm() {
            this.formData = {
                nom: '',
                type: '',
                autreActivite: '',
                ville: '',
                pays: '',
                devise: '',
                email: '',
                telephone: '',
                numeroRegistre: '',
                siteWeb: '',
                description: '',
                logo: null
            };
            this.logoPreview = null;
        }
    }
}
</script>
{% endblock %}
