{% load static %}
<!DOCTYPE html>
<html lang="fr" class="scroll-smooth" 
      x-data="{ 
          darkMode: localStorage.getItem('darkMode') === 'true',
          sidebarOpen: localStorage.getItem('sidebarOpen') !== 'false',
          mobileMenuOpen: false 
      }" 
      x-init="
          $watch('darkMode', val => localStorage.setItem('darkMode', val));
          $watch('sidebarOpen', val => localStorage.setItem('sidebarOpen', val));
      " 
      :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard - Walee{% endblock %}</title>
    
    <!-- SEO Meta -->
    <meta name="description" content="Walee - Plateforme de gestion d'entreprise moderne">
    <meta name="author" content="Walee">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/logo-placeholder.svg' %}">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Google Fonts - Optimized loading -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'walee-blue': '#2563EB',
                        'walee-indigo': '#1E3A8A',
                        'walee-green': '#10B981',
                        'walee-red': '#EF4444',
                        'walee-gray': '#F3F4F6',
                        'walee-dark': '#111827',
                        'walee-bg': '#FAFAFA',
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'inter': ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'fade-in': 'fadeIn 0.2s ease-in',
                        'bounce-subtle': 'bounceSubtle 0.5s ease-in-out',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94A3B8;
        }
        /* Smooth transitions */
        * {
            transition-property: background-color, border-color, color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }
        /* Loading indicator */
        .loading-spinner {
            border: 3px solid rgba(37, 99, 235, 0.1);
            border-top-color: #2563EB;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-walee-bg dark:bg-gray-900 transition-colors duration-200">
    
    <!-- Loading Overlay -->
    <div x-data="{ loading: false }" 
         x-show="loading" 
         x-cloak
         class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-2xl text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-400">Chargement...</p>
        </div>
    </div>
    
    <!-- Sidebar Desktop -->
    <aside :class="sidebarOpen ? 'w-64' : 'w-20'" 
           class="fixed left-0 top-0 h-full bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 z-40 hidden md:block shadow-lg">
        
        <!-- Logo -->
        <div class="h-16 flex items-center justify-between px-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center space-x-3 overflow-hidden">
                <img src="{% static 'images/logo-placeholder.svg' %}" alt="Walee" class="w-8 h-8 flex-shrink-0">
                <span x-show="sidebarOpen" 
                      x-transition:enter="transition ease-out duration-200"
                      x-transition:enter-start="opacity-0 scale-95"
                      x-transition:enter-end="opacity-100 scale-100"
                      class="text-xl font-bold font-poppins text-walee-blue dark:text-walee-green whitespace-nowrap">
                    Walee
                </span>
            </div>
            <button @click="sidebarOpen = !sidebarOpen" 
                    class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex-shrink-0"
                    title="Toggle sidebar">
                <i data-lucide="menu" class="w-5 h-5 text-gray-600 dark:text-gray-300"></i>
            </button>
        </div>
        
        <!-- Navigation -->
        <nav class="p-4 space-y-1 overflow-y-auto" style="max-height: calc(100vh - 140px);">
            
            <!-- Dashboard -->
            <a href="{% url 'dashboard' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative overflow-hidden
                      {% if request.resolver_match.url_name == 'dashboard' %}
                          bg-gradient-to-r from-walee-blue to-blue-600 text-white shadow-lg shadow-blue-500/30
                      {% else %}
                          hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Dashboard">
                <i data-lucide="layout-dashboard" class="w-5 h-5 flex-shrink-0 {% if request.resolver_match.url_name == 'dashboard' %}animate-bounce-subtle{% endif %}"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Dashboard</span>
                {% if request.resolver_match.url_name == 'dashboard' %}
                <span class="absolute right-0 top-0 bottom-0 w-1 bg-white rounded-l"></span>
                {% endif %}
            </a>
            
            <!-- Entreprises -->
            <a href="{% url 'entreprises' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative
                      {% if request.resolver_match.url_name == 'entreprises' %}
                          bg-gradient-to-r from-walee-green to-green-600 text-white shadow-lg shadow-green-500/30
                      {% else %}
                          hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Entreprises">
                <i data-lucide="building-2" class="w-5 h-5 flex-shrink-0"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Entreprises</span>
            </a>
            
            <!-- Employés -->
            <a href="{% url 'employees' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative
                      {% if request.resolver_match.url_name == 'employees' %}
                          bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg shadow-purple-500/30
                      {% else %}
                          hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Employés">
                <i data-lucide="users" class="w-5 h-5 flex-shrink-0"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Employés</span>
            </a>
            
            <!-- Ventes -->
            <a href="{% url 'ventes' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative
                      {% if request.resolver_match.url_name == 'ventes' %}
                          bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg shadow-green-500/30
                      {% else %}
                          hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Ventes">
                <i data-lucide="shopping-cart" class="w-5 h-5 flex-shrink-0"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Ventes</span>
                <!-- Badge notification -->
                <span x-show="sidebarOpen" class="ml-auto px-2 py-0.5 bg-green-500 text-white text-xs rounded-full">3</span>
            </a>
            
            <!-- Stock -->
            <a href="{% url 'stock' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative
                      {% if request.resolver_match.url_name == 'stock' %}
                          bg-gradient-to-r from-orange-600 to-amber-600 text-white shadow-lg shadow-orange-500/30
                      {% else %}
                          hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Stock">
                <i data-lucide="package" class="w-5 h-5 flex-shrink-0"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Stock</span>
                <!-- Badge alerte -->
                <span x-show="sidebarOpen" class="ml-auto">
                    <i data-lucide="alert-circle" class="w-4 h-4 text-orange-500"></i>
                </span>
            </a>
            
            <!-- Factures -->
            <a href="{% url 'factures' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative
                      {% if request.resolver_match.url_name == 'factures' %}
                          bg-gradient-to-r from-indigo-600 to-blue-700 text-white shadow-lg shadow-indigo-500/30
                      {% else %}
                          hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Factures">
                <i data-lucide="file-text" class="w-5 h-5 flex-shrink-0"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Factures</span>
            </a>
            
            <!-- Statistiques -->
            <a href="{% url 'statistiques' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative
                      {% if request.resolver_match.url_name == 'statistiques' %}
                          bg-gradient-to-r from-pink-600 to-rose-600 text-white shadow-lg shadow-pink-500/30
                      {% else %}
                          hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Statistiques">
                <i data-lucide="bar-chart-3" class="w-5 h-5 flex-shrink-0"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Statistiques</span>
            </a>
            
            <!-- Intelligence AI -->
            <a href="{% url 'intelligence' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative
                      {% if request.resolver_match.url_name == 'intelligence' %}
                          bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 text-white shadow-lg shadow-purple-500/30
                      {% else %}
                          hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 dark:hover:from-purple-900/20 dark:hover:to-pink-900/20 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Intelligence AI">
                <i data-lucide="brain" class="w-5 h-5 flex-shrink-0 {% if request.resolver_match.url_name != 'intelligence' %}group-hover:animate-pulse{% endif %}"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Intelligence</span>
                <span x-show="sidebarOpen" class="ml-auto px-1.5 py-0.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-[10px] rounded font-bold">AI</span>
            </a>
            
            <div class="border-t border-gray-200 dark:border-gray-700 my-2"></div>
            
            <!-- Paramètres -->
            <a href="{% url 'parametres' %}" 
               class="group flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 relative
                      {% if request.resolver_match.url_name == 'parametres' %}
                          bg-gradient-to-r from-gray-600 to-gray-700 text-white shadow-lg shadow-gray-500/30
                      {% else %}
                          hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300
                      {% endif %}"
               title="Paramètres">
                <i data-lucide="settings" class="w-5 h-5 flex-shrink-0"></i>
                <span x-show="sidebarOpen" class="whitespace-nowrap font-medium">Paramètres</span>
            </a>
            
        </nav>
        
        <!-- User Profile (bottom) -->
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
            <div class="flex items-center space-x-3 px-3 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer">
                <div class="w-10 h-10 bg-gradient-to-br from-walee-blue to-walee-indigo rounded-full flex items-center justify-center text-white font-semibold shadow-lg flex-shrink-0">
                    JD
                </div>
                <div x-show="sidebarOpen" class="overflow-hidden">
                    <p class="text-sm font-semibold text-gray-900 dark:text-white truncate">John Doe</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Administrateur</p>
                </div>
            </div>
        </div>
        
    </aside>
    
    <!-- Mobile Sidebar Overlay -->
    <div x-show="mobileMenuOpen" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click="mobileMenuOpen = false"
         class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 md:hidden">
    </div>
    
    <!-- Mobile Sidebar -->
    <aside x-show="mobileMenuOpen"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="-translate-x-full"
           x-transition:enter-end="translate-x-0"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="translate-x-0"
           x-transition:leave-end="-translate-x-full"
           class="fixed left-0 top-0 h-full w-72 bg-white dark:bg-gray-800 z-50 md:hidden shadow-2xl">
        
        <!-- Logo -->
        <div class="h-16 flex items-center justify-between px-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center space-x-3">
                <img src="{% static 'images/logo-placeholder.svg' %}" alt="Walee" class="w-8 h-8">
                <span class="text-xl font-bold font-poppins text-walee-blue dark:text-walee-green">Walee</span>
            </div>
            <button @click="mobileMenuOpen = false" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                <i data-lucide="x" class="w-5 h-5 text-gray-600 dark:text-gray-300"></i>
            </button>
        </div>
        
        <!-- Same navigation as desktop -->
        <nav class="p-4 space-y-1 overflow-y-auto" style="max-height: calc(100vh - 140px);">
            <!-- Copy navigation items from desktop sidebar -->
            <a href="{% url 'dashboard' %}" @click="mobileMenuOpen = false" class="flex items-center space-x-3 px-4 py-3 rounded-xl {% if request.resolver_match.url_name == 'dashboard' %}bg-gradient-to-r from-walee-blue to-blue-600 text-white{% else %}text-gray-700 dark:text-gray-300{% endif %}">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span class="font-medium">Dashboard</span>
            </a>
            <!-- Add other menu items similarly -->
        </nav>
        
        <!-- User Profile -->
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 dark:border-gray-700">
            <div class="flex items-center space-x-3 px-3 py-2">
                <div class="w-10 h-10 bg-gradient-to-br from-walee-blue to-walee-indigo rounded-full flex items-center justify-center text-white font-semibold">
                    JD
                </div>
                <div>
                    <p class="text-sm font-semibold text-gray-900 dark:text-white">John Doe</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Administrateur</p>
                </div>
            </div>
        </div>
        
    </aside>
    
    <!-- Main Content -->
    <main :class="sidebarOpen ? 'md:ml-64' : 'md:ml-20'" class="transition-all duration-300">
        
        <!-- Top Header -->
        <header class="h-16 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-30 shadow-sm">
            <div class="h-full px-4 lg:px-6 flex items-center justify-between gap-4">
                
                <!-- Mobile Menu Button -->
                <button @click="mobileMenuOpen = true" class="md:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                    <i data-lucide="menu" class="w-6 h-6 text-gray-600 dark:text-gray-300"></i>
                </button>
                
                <!-- Search Bar -->
                <div class="hidden md:flex items-center flex-1 max-w-2xl">
                    <div class="relative w-full" x-data="{ focused: false }">
                        <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400 dark:text-gray-500 transition-colors" :class="focused ? 'text-walee-blue' : ''"></i>
                        <input type="text" 
                               @focus="focused = true"
                               @blur="focused = false"
                               placeholder="Rechercher des produits, clients, commandes..." 
                               class="w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-2 focus:ring-walee-blue focus:border-transparent outline-none transition-all placeholder:text-gray-400 dark:placeholder:text-gray-500">
                        <!-- Quick search suggestions could go here -->
                    </div>
                </div>
                
                <!-- Right Actions -->
                <div class="flex items-center space-x-2 lg:space-x-3">
                    
                    <!-- Quick Add Button -->
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" 
                                class="hidden lg:flex items-center gap-2 px-4 py-2 bg-walee-blue hover:bg-blue-700 text-white rounded-lg transition-all shadow-sm hover:shadow-md"
                                title="Actions rapides">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                            <span class="font-medium text-sm">Nouveau</span>
                        </button>
                        
                        <!-- Dropdown -->
                        <div x-show="open" 
                             @click.away="open = false"
                             x-transition
                             class="absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50"
                             style="display: none;">
                            <a href="#" class="flex items-center gap-3 px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                <i data-lucide="shopping-cart" class="w-4 h-4 text-green-600"></i>
                                <span class="text-sm text-gray-700 dark:text-gray-300">Nouvelle vente</span>
                            </a>
                            <a href="#" class="flex items-center gap-3 px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                <i data-lucide="file-text" class="w-4 h-4 text-blue-600"></i>
                                <span class="text-sm text-gray-700 dark:text-gray-300">Créer facture</span>
                            </a>
                            <a href="#" class="flex items-center gap-3 px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                <i data-lucide="package" class="w-4 h-4 text-orange-600"></i>
                                <span class="text-sm text-gray-700 dark:text-gray-300">Ajouter produit</span>
                            </a>
                            <a href="#" class="flex items-center gap-3 px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                <i data-lucide="user-plus" class="w-4 h-4 text-purple-600"></i>
                                <span class="text-sm text-gray-700 dark:text-gray-300">Nouveau client</span>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Dark Mode Toggle -->
                    <button @click="darkMode = !darkMode" 
                            class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all relative group"
                            title="Changer le thème">
                        <i x-show="!darkMode" data-lucide="moon" class="w-5 h-5 text-gray-600 dark:text-gray-300"></i>
                        <i x-show="darkMode" data-lucide="sun" class="w-5 h-5 text-gray-600 dark:text-gray-300"></i>
                        <span class="absolute -bottom-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                            <span x-text="darkMode ? 'Mode clair' : 'Mode sombre'"></span>
                        </span>
                    </button>
                    
                    <!-- Notifications -->
                    <div class="relative" x-data="{ open: false, unreadCount: 3 }">
                        <button @click="open = !open" 
                                class="relative p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all"
                                title="Notifications">
                            <i data-lucide="bell" class="w-5 h-5 text-gray-600 dark:text-gray-300"></i>
                            <span x-show="unreadCount > 0" 
                                  class="absolute top-1 right-1 w-4 h-4 bg-walee-red rounded-full flex items-center justify-center text-white text-[10px] font-bold animate-pulse">
                                <span x-text="unreadCount"></span>
                            </span>
                        </button>
                        
                        <!-- Notifications Dropdown -->
                        <div x-show="open" 
                             @click.away="open = false"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 scale-95"
                             x-transition:enter-end="opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-150"
                             x-transition:leave-start="opacity-100 scale-100"
                             x-transition:leave-end="opacity-0 scale-95"
                             class="absolute right-0 mt-2 w-96 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50"
                             style="display: none;">
                            
                            <!-- Header -->
                            <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-700/50">
                                <h3 class="font-bold text-gray-900 dark:text-white">Notifications</h3>
                                <div class="flex items-center gap-2">
                                    <span class="text-xs px-2 py-1 bg-walee-red text-white rounded-full font-medium" x-text="unreadCount"></span>
                                    <button class="text-xs text-walee-blue hover:text-walee-indigo font-medium">Tout marquer comme lu</button>
                                </div>
                            </div>
                            
                            <!-- Notifications List -->
                            <div class="max-h-[28rem] overflow-y-auto">
                                
                                <!-- Notification Item - Unread -->
                                <div class="p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition cursor-pointer border-b border-gray-100 dark:border-gray-700 bg-blue-50/50 dark:bg-blue-900/10">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-10 h-10 bg-green-100 dark:bg-green-900/50 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i data-lucide="shopping-cart" class="w-5 h-5 text-green-600 dark:text-green-400"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-semibold text-gray-900 dark:text-white">Nouvelle vente enregistrée</p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Commande #VNT-12345 • 125,000 FCFA</p>
                                            <div class="flex items-center gap-2 mt-2">
                                                <span class="text-xs text-gray-500 dark:text-gray-400">Il y a 5 minutes</span>
                                                <span class="w-1.5 h-1.5 bg-walee-blue rounded-full"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Notification Item -->
                                <div class="p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition cursor-pointer border-b border-gray-100 dark:border-gray-700">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/50 rounded-lg flex items-center justify-center flex-shrink-0">
                                            <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600 dark:text-orange-400"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Alerte stock faible</p>
                                            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Laptop HP Pavilion - 3 unités restantes</p>
                                            <span class="text-xs text-gray-500 dark:text-gray-400 mt-2 inline-block">Il y a 1 heure</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- More notifications... -->
                                
                            </div>
                            
                            <!-- Footer -->
                            <div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                                <button class="w-full text-sm text-walee-blue hover:text-walee-indigo font-medium text-center py-1 transition-colors">
                                    Voir toutes les notifications
                                </button>
                            </div>
                            
                        </div>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" 
                                class="flex items-center space-x-2 p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all">
                            <div class="w-8 h-8 bg-gradient-to-br from-walee-blue to-walee-indigo rounded-full flex items-center justify-center text-white text-sm font-bold shadow-md">
                                JD
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-gray-600 dark:text-gray-300 hidden lg:block"></i>
                        </button>
                        
                        <div x-show="open" 
                             @click.away="open = false"
                             x-transition
                             class="absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 py-2 z-50"
                             style="display: none;">
                            
                            <!-- User Info -->
                            <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                                <p class="text-sm font-semibold text-gray-900 dark:text-white">John Doe</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">john.doe@walee.com</p>
                            </div>
                            
                            <a href="{% url 'profil' %}" class="flex items-center gap-3 px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                <i data-lucide="user" class="w-4 h-4 text-gray-600 dark:text-gray-400"></i>
                                <span class="text-sm text-gray-700 dark:text-gray-300">Mon profil</span>
                            </a>
                            
                            <a href="{% url 'parametres' %}" class="flex items-center gap-3 px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                <i data-lucide="settings" class="w-4 h-4 text-gray-600 dark:text-gray-400"></i>
                                <span class="text-sm text-gray-700 dark:text-gray-300">Paramètres</span>
                            </a>
                            
                            <a href="#" class="flex items-center gap-3 px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                <i data-lucide="help-circle" class="w-4 h-4 text-gray-600 dark:text-gray-400"></i>
                                <span class="text-sm text-gray-700 dark:text-gray-300">Aide & Support</span>
                            </a>
                            
                            <hr class="my-2 border-gray-200 dark:border-gray-700">
                            
                            <a href="{% url 'home' %}" class="flex items-center gap-3 px-4 py-2.5 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors group">
                                <i data-lucide="log-out" class="w-4 h-4 text-walee-red"></i>
                                <span class="text-sm text-walee-red font-medium">Déconnexion</span>
                            </a>
                        </div>
                    </div>
                    
                </div>
                
            </div>
        </header>
        
        <!-- Page Content -->
        <div class="p-4 lg:p-6 min-h-screen">
            {% block dashboard_content %}{% endblock %}
        </div>
        
        <!-- Footer -->
        <footer class="px-4 lg:px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
            <div class="flex flex-col md:flex-row items-center justify-between gap-2 text-sm text-gray-600 dark:text-gray-400">
                <p>&copy; 2025 Walee. Tous droits réservés.</p>
                <div class="flex items-center gap-4">
                    <a href="#" class="hover:text-walee-blue transition-colors">Conditions d'utilisation</a>
                    <a href="#" class="hover:text-walee-blue transition-colors">Politique de confidentialité</a>
                    <a href="#" class="hover:text-walee-blue transition-colors">Contact</a>
                </div>
            </div>
        </footer>
        
    </main>
    
    <!-- Toast Notifications Container -->
    <div x-data="toastManager()" class="fixed bottom-4 right-4 z-50 space-y-2" style="max-width: 400px;">
        <!-- Toast messages will be dynamically added here -->
    </div>
    
    <!-- Initialize Lucide Icons (Optimized) -->
    <script>
        // Initialize icons once when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
        
        // Reinitialize on Alpine.js init
        document.addEventListener('alpine:init', () => {
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        });
        
        // Debounced icon refresh on dynamic content changes
        let iconRefreshTimer;
        const refreshIcons = () => {
            clearTimeout(iconRefreshTimer);
            iconRefreshTimer = setTimeout(() => {
                lucide.createIcons();
            }, 300);
        };
        
        // Toast notification system
        function toastManager() {
            return {
                toasts: [],
                show(message, type = 'info') {
                    const id = Date.now();
                    this.toasts.push({ id, message, type });
                    setTimeout(() => {
                        this.remove(id);
                    }, 5000);
                },
                remove(id) {
                    const index = this.toasts.findIndex(t => t.id === id);
                    if (index > -1) this.toasts.splice(index, 1);
                }
            }
        }
    </script>
    
    {% block extra_js %}{% endblock %}
    
</body>
</html>