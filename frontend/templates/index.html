{% extends "dashboard/base_dashboard.html" %}
{% load static %}

{% block title %}Dashboard - Walee{% endblock %}

{% block dashboard_content %}
<div x-data="dashboardData()">
    
    <!-- Welcome Section -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold font-poppins text-walee-dark dark:text-white mb-2">
                    Bonjour, John üëã
                </h1>
                <p class="text-gray-600 dark:text-gray-400">Voici un aper√ßu de votre activit√© aujourd'hui</p>
            </div>
            <div class="text-right hidden md:block">
                <p class="text-sm text-gray-500 dark:text-gray-400" x-text="currentTime"></p>
            </div>
        </div>
    </div>
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        
        <!-- Card 1: Ventes du jour -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center">
                    <i data-lucide="trending-up" class="w-6 h-6 text-walee-blue"></i>
                </div>
                <span class="text-green-500 text-sm font-medium">+12.5%</span>
            </div>
            <h3 class="text-gray-500 dark:text-gray-400 text-sm mb-1">Ventes du jour</h3>
            <p class="text-3xl font-bold font-poppins text-walee-dark dark:text-white">2.5M</p>
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">FCFA</p>
        </div>
        
        <!-- Card 2: Commandes -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center">
                    <i data-lucide="shopping-bag" class="w-6 h-6 text-walee-green"></i>
                </div>
                <span class="text-green-500 text-sm font-medium">+8.2%</span>
            </div>
            <h3 class="text-gray-500 dark:text-gray-400 text-sm mb-1">Commandes</h3>
            <p class="text-3xl font-bold font-poppins text-walee-dark dark:text-white">156</p>
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Aujourd'hui</p>
        </div>
        
        <!-- Card 3: Produits en stock -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center">
                    <i data-lucide="package" class="w-6 h-6 text-purple-600 dark:text-purple-400"></i>
                </div>
                <span class="text-orange-500 text-sm font-medium">3 alertes</span>
            </div>
            <h3 class="text-gray-500 dark:text-gray-400 text-sm mb-1">Produits en stock</h3>
            <p class="text-3xl font-bold font-poppins text-walee-dark dark:text-white">1,234</p>
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Articles</p>
        </div>
        
        <!-- Card 4: Clients -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center justify-center">
                    <i data-lucide="users" class="w-6 h-6 text-orange-600"></i>
                </div>
                <span class="text-green-500 text-sm font-medium">+24</span>
            </div>
            <h3 class="text-gray-500 dark:text-gray-400 text-sm mb-1">Clients actifs</h3>
            <p class="text-3xl font-bold font-poppins text-walee-dark dark:text-white">892</p>
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Ce mois</p>
        </div>
        
    </div>
    
    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        
        <!-- Sales Chart -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold font-poppins text-walee-dark dark:text-white">Ventes de la semaine</h3>
                <select x-model="salesPeriod" @change="updateSalesChart()" class="text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg px-3 py-1 outline-none focus:ring-2 focus:ring-walee-blue">
                    <option value="7">7 derniers jours</option>
                    <option value="30">30 derniers jours</option>
                </select>
            </div>
            <div class="h-64">
                <canvas id="salesChart"></canvas>
            </div>
        </div>
        
        <!-- Products Chart -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold font-poppins text-walee-dark dark:text-white">Produits les plus vendus</h3>
                <a href="#" class="text-sm text-walee-blue hover:text-walee-indigo font-medium">
                    Voir tout
                </a>
            </div>
            <div class="h-64">
                <canvas id="productsChart"></canvas>
            </div>
        </div>
        
    </div>
    
    <!-- Recent Activity & Quick Actions -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Recent Orders -->
        <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold font-poppins text-walee-dark dark:text-white">Commandes r√©centes</h3>
                <a href="#" class="text-sm text-walee-blue hover:text-walee-indigo font-medium">
                    Voir tout
                </a>
            </div>
            
            <div class="space-y-3">
                <!-- Order Item -->
                <div class="flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                            <i data-lucide="shopping-cart" class="w-5 h-5 text-walee-blue"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">Commande #12345</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Jean Dupont ‚Ä¢ Il y a 5 min</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-gray-900 dark:text-white">125,000 FCFA</p>
                        <span class="inline-block px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full">Pay√©e</span>
                    </div>
                </div>
                
                <!-- Order Item -->
                <div class="flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                            <i data-lucide="shopping-cart" class="w-5 h-5 text-walee-blue"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">Commande #12344</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Marie Martin ‚Ä¢ Il y a 12 min</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-gray-900 dark:text-white">89,500 FCFA</p>
                        <span class="inline-block px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs rounded-full">En attente</span>
                    </div>
                </div>
                
                <!-- Order Item -->
                <div class="flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                            <i data-lucide="shopping-cart" class="w-5 h-5 text-walee-blue"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900 dark:text-white">Commande #12343</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Pierre Dubois ‚Ä¢ Il y a 1h</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-semibold text-gray-900 dark:text-white">245,000 FCFA</p>
                        <span class="inline-block px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full">Pay√©e</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm">
            <h3 class="text-lg font-semibold font-poppins text-walee-dark dark:text-white mb-6">Actions rapides</h3>
            
            <div class="space-y-3">
                <button class="w-full flex items-center space-x-3 px-4 py-3 bg-walee-blue text-white rounded-xl hover:bg-blue-700 transition-colors">
                    <i data-lucide="plus-circle" class="w-5 h-5"></i>
                    <span class="font-medium">Nouvelle vente</span>
                </button>
                
                <button class="w-full flex items-center space-x-3 px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    <i data-lucide="file-text" class="w-5 h-5 text-gray-600 dark:text-gray-400"></i>
                    <span class="font-medium text-gray-700 dark:text-gray-300">Cr√©er une facture</span>
                </button>
                
                <button class="w-full flex items-center space-x-3 px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    <i data-lucide="package" class="w-5 h-5 text-gray-600 dark:text-gray-400"></i>
                    <span class="font-medium text-gray-700 dark:text-gray-300">Ajouter un produit</span>
                </button>
                
                <button class="w-full flex items-center space-x-3 px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    <i data-lucide="user-plus" class="w-5 h-5 text-gray-600 dark:text-gray-400"></i>
                    <span class="font-medium text-gray-700 dark:text-gray-300">Nouveau client</span>
                </button>
            </div>
            
            <!-- Alerts -->
            <div class="mt-6 p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl">
                <div class="flex items-start space-x-3">
                    <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600 dark:text-orange-400 mt-0.5"></i>
                    <div>
                        <p class="text-sm font-medium text-orange-900 dark:text-orange-300">3 produits en rupture</p>
                        <p class="text-xs text-orange-700 dark:text-orange-400 mt-1">V√©rifiez votre stock</p>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
</div>
{% endblock %}

{% block extra_js %}
<script>
// Configuration optimis√©e de Chart.js - animations d√©sactiv√©es pour les performances
Chart.defaults.animation = false;
Chart.defaults.responsive = true;
Chart.defaults.maintainAspectRatio = false;

function dashboardData() {
    return {
        salesPeriod: '7',
        currentTime: '',
        salesChart: null,
        productsChart: null,
        
        init() {
            this.updateTime();
            // Mise √† jour de l'heure toutes les minutes au lieu de chaque seconde
            setInterval(() => this.updateTime(), 60000);
            
            // Initialiser les graphiques
            this.$nextTick(() => {
                this.initCharts();
            });
        },
        
        updateTime() {
            const now = new Date();
            this.currentTime = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        },
        
        initCharts() {
            this.initSalesChart();
            this.initProductsChart();
        },
        
        initSalesChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) return;
            
            const isDark = document.documentElement.classList.contains('dark');
            
            this.salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
                    datasets: [{
                        label: 'Ventes',
                        data: [1200000, 1900000, 1500000, 2100000, 1800000, 2500000, 2200000],
                        borderColor: '#2563EB',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => (ctx.parsed.y / 1000000).toFixed(1) + 'M FCFA'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: isDark ? '#374151' : '#E5E7EB' },
                            ticks: {
                                color: isDark ? '#9CA3AF' : '#6B7280',
                                callback: (val) => (val / 1000000).toFixed(1) + 'M'
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: isDark ? '#9CA3AF' : '#6B7280' }
                        }
                    }
                }
            });
        },
        
        initProductsChart() {
            const ctx = document.getElementById('productsChart');
            if (!ctx) return;
            
            const isDark = document.documentElement.classList.contains('dark');
            
            this.productsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['√âlectronique', 'V√™tements', 'Alimentation', 'Autres'],
                    datasets: [{
                        data: [35, 25, 20, 20],
                        backgroundColor: ['#2563EB', '#10B981', '#F59E0B', '#8B5CF6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: isDark ? '#9CA3AF' : '#6B7280',
                                padding: 12,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => ctx.label + ': ' + ctx.parsed + '%'
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        },
        
        updateSalesChart() {
            if (!this.salesChart) return;
            
            const data = this.salesPeriod === '7' 
                ? [1200000, 1900000, 1500000, 2100000, 1800000, 2500000, 2200000]
                : [8500000, 9200000, 8800000, 9500000];
            
            const labels = this.salesPeriod === '7'
                ? ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim']
                : ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'];
            
            this.salesChart.data.labels = labels;
            this.salesChart.data.datasets[0].data = data;
            this.salesChart.update('none'); // Mise √† jour sans animation
        }
    }
}
</script>
{% endblock %}